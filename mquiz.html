```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Millionaire Arena</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { margin: 0; overflow-x: hidden; background-color: #0f172a; }
        /* Custom scrollbar for game look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .scale-102:hover { transform: scale(1.02); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // ==================== EMBEDDED CSV DATA ====================
        // I have parsed your CSV file and converted it into this object structure
        // so it loads instantly without needing an internet connection to Google Sheets.
        // ==================== EMBEDDED CSV DATA ====================
const EMBEDDED_QUESTIONS = {
  math: {
    easy: [
      { q: "What is 150 + 250?", o: ["300","350","400","450"], a: 2 },
      { q: "What is 9 Ã— 8?", o: ["71","72","73","81"], a: 1 },
      { q: "How many sides does a hexagon have?", o: ["5","6","7","8"], a: 1 },
      { q: "What is half of 150?", o: ["70","75","80","85"], a: 1 },
      { q: "What is 1000 - 350?", o: ["550","600","650","750"], a: 2 },
      { q: "Which number is even?", o: ["27","31","49","52"], a: 3 },
      { q: "How many minutes in 2 hours?", o: ["100","120","140","160"], a: 1 },
      { q: "What is 45 Ã· 5?", o: ["7","8","9","10"], a: 2 },
      { q: "How many grams in a kilogram?", o: ["10","100","1000","10000"], a: 2 },
      { q: "What is double 45?", o: ["80","85","90","95"], a: 2 },
      { q: "Which is largest?", o: ["0.5","0.1","0.9","0.09"], a: 2 },
      { q: "20 + 20 + 20 + 20 is the same as:", o: ["20 Ã— 4","20 Ã— 5","40 + 20","100"], a: 0 },
      { q: "What is the perimeter of a square with side 5cm?", o: ["10cm","15cm","20cm","25cm"], a: 2 },
      { q: "How many degrees in a right angle?", o: ["45","90","180","360"], a: 1 },
      { q: "Round 4.7 to the nearest whole number.", o: ["4","4.5","5","10"], a: 2 }
    ],
    medium: [
      { q: "What is 12 squared (12Â²)?", o: ["124","144","164","122"], a: 1 },
      { q: "What is 15% of 200?", o: ["15","20","25","30"], a: 3 },
      { q: "Solve for x: 3x + 5 = 20", o: ["3","4","5","6"], a: 2 },
      { q: "Which fraction is equivalent to 0.75?", o: ["1/2","2/3","3/4","4/5"], a: 2 },
      { q: "A train leaves at 2:15 and arrives at 3:45. How long is the trip?", o: ["1h 15m","1h 30m","1h 45m","2h"], a: 1 },
      { q: "What is the area of a rectangle 8cm by 6cm?", o: ["14cmÂ²","28cmÂ²","48cmÂ²","64cmÂ²"], a: 2 },
      { q: "What is the next prime number after 7?", o: ["9","10","11","13"], a: 2 },
      { q: "If 1kg of apples costs $4, how much for 2.5kg?", o: ["$8","$9","$10","$12"], a: 2 },
      { q: "Simplify 12/16", o: ["2/3","3/4","4/5","6/8"], a: 1 },
      { q: "What is 5 cubed (5Â³)?", o: ["15","25","100","125"], a: 3 },
      { q: "What is the mean (average) of 4, 6, and 8?", o: ["5","6","7","8"], a: 1 },
      { q: "How many milliliters in 1.5 Liters?", o: ["150","1500","15000","15"], a: 1 },
      { q: "Roman numeral XV is:", o: ["10","12","15","20"], a: 2 },
      { q: "25 + 25 Ã— 2 = ?", o: ["100","75","50","125"], a: 1 },
      { q: "How many zeros in one million?", o: ["5","6","7","8"], a: 1 }
    ],
    hard: [
      { q: "What is the square root of 81?", o: ["7","8","9","11"], a: 2 },
      { q: "Solve: 50 - 3 Ã— 10 + 5", o: ["475","25","35","15"], a: 1 },
      { q: "What is 1/3 + 1/6?", o: ["2/9","1/2","2/3","5/6"], a: 1 },
      { q: "A triangle has angles 40Â° and 60Â°. What is the third angle?", o: ["60Â°","80Â°","90Â°","100Â°"], a: 1 },
      { q: "If x = 4 and y = 3, what is 2x - y?", o: ["3","5","6","8"], a: 1 },
      { q: "What is 20% of 50% of 100?", o: ["10","20","25","50"], a: 0 },
      { q: "A car travels 60km in 45 mins. What is its speed?", o: ["60km/h","70km/h","80km/h","90km/h"], a: 2 },
      { q: "Which number is a factor of both 24 and 32?", o: ["6","8","12","16"], a: 1 },
      { q: "What is -5 + 12?", o: ["-7","7","-17","17"], a: 1 },
      { q: "Calculate the circumference: Diameter = 10 (use Ï€â‰ˆ3.14)", o: ["15.7","31.4","62.8","314"], a: 1 },
      { q: "There are 5 red and 3 blue balls. Probability of picking blue?", o: ["3/5","3/8","5/8","1/3"], a: 1 },
      { q: "What is 2 to the power of 5 (2âµ)?", o: ["10","16","32","64"], a: 2 },
      { q: "An angle greater than 90Â° but less than 180Â° is called:", o: ["Acute","Right","Obtuse","Reflex"], a: 2 },
      { q: "Which is not a prime number?", o: ["29","31","37","39"], a: 3 },
      { q: "0.2 Ã— 0.3 =", o: ["0.6","0.06","6.0","0.5"], a: 1 }
    ]
  },
  science: {
    easy: [
      { q: "What planet do we live on?", o: ["Mars","Venus","Earth","Jupiter"], a: 2 },
      { q: "Which animal lays eggs?", o: ["Dog","Cat","Chicken","Cow"], a: 2 },
      { q: "What is the center of an atom?", o: ["Nucleus","Shell","Electron","Core"], a: 0 },
      { q: "H2O is the chemical formula for:", o: ["Air","Water","Fire","Ice"], a: 1 },
      { q: "Which organ pumps blood?", o: ["Brain","Lungs","Heart","Stomach"], a: 2 },
      { q: "Plants get energy from:", o: ["Wind","The Sun","Rocks","Insects"], a: 1 },
      { q: "What forces pulls objects to the ground?", o: ["Magnetic","Friction","Gravity","Elastic"], a: 2 },
      { q: "How many legs does a spider have?", o: ["6","8","10","12"], a: 1 },
      { q: "Which is a gas?", o: ["Wood","Water","Oxygen","Ice"], a: 2 },
      { q: "The sun is a:", o: ["Planet","Star","Moon","Asteroid"], a: 1 }
    ],
    medium: [
      { q: "What gas do plants absorb from the air?", o: ["Oxygen","Carbon Dioxide","Nitrogen","Helium"], a: 1 },
      { q: "Which part of the plant absorbs water?", o: ["Leaves","Stem","Roots","Flower"], a: 2 },
      { q: "What is the hardest natural mineral?", o: ["Gold","Iron","Diamond","Quartz"], a: 2 },
      { q: "Which planet is known as the Red Planet?", o: ["Venus","Jupiter","Saturn","Mars"], a: 3 },
      { q: "What covers most of the Earth's surface?", o: ["Forest","Desert","Water","Ice"], a: 2 },
      { q: "The process of liquid turning into gas is:", o: ["Melting","Freezing","Condensation","Evaporation"], a: 3 },
      { q: "Which animal is a mammal?", o: ["Shark","Frog","Dolphin","Eagle"], a: 2 },
      { q: "What protects the brain?", o: ["Ribcage","Skull","Spine","Pelvis"], a: 1 },
      { q: "Light travels faster than:", o: ["Sound","Electricity","Radio waves","Everything"], a: 0 },
      { q: "Which rock floats in water?", o: ["Granite","Pumice","Marble","Slate"], a: 1 }
    ],
    hard: [
      { q: "What is the chemical symbol for Gold?", o: ["Gd","Go","Au","Ag"], a: 2 },
      { q: "Newton's First Law is about:", o: ["Gravity","Inertia","Action/Reaction","Friction"], a: 1 },
      { q: "Which part of the cell contains DNA?", o: ["Mitochondria","Nucleus","Ribosome","Membrane"], a: 1 },
      { q: "What is the most abundant gas in our atmosphere?", o: ["Oxygen","Carbon Dioxide","Nitrogen","Hydrogen"], a: 2 },
      { q: "Photosynthesis takes place in the:", o: ["Nucleus","Chloroplasts","Mitochondria","Cell Wall"], a: 1 },
      { q: "What is the pH of pure water?", o: ["5","7","9","10"], a: 1 },
      { q: "Which planet has the most moons?", o: ["Jupiter","Saturn","Uranus","Neptune"], a: 1 },
      { q: "Kinetic energy is the energy of:", o: ["Height","Motion","Heat","Light"], a: 1 },
      { q: "What type of rock is formed from lava?", o: ["Sedimentary","Metamorphic","Igneous","Fossil"], a: 2 },
      { q: "The smallest bone in the body is in the:", o: ["Hand","Foot","Nose","Ear"], a: 3 }
    ]
  },
  soccer: {
    easy: [
      { q: "How many players are on the field for one team?", o: ["9","10","11","12"], a: 2 },
      { q: "Which position guards the net?", o: ["Striker","Midfielder","Defender","Goalkeeper"], a: 3 },
      { q: "What happens if you touch the ball with your hands?", o: ["Goal","Foul","Point","Nothing"], a: 1 },
      { q: "What color card means 'Sent Off'?", o: ["Yellow","Blue","Red","Green"], a: 2 },
      { q: "How long is a standard soccer match?", o: ["45 mins","60 mins","90 mins","100 mins"], a: 2 },
      { q: "What do you call 3 goals by one player?", o: ["Home Run","Touchdown","Hat-trick","Strikeout"], a: 2 },
      { q: "The big tournament held every 4 years is:", o: ["The Super Bowl","The World Cup","The World Series","The Olympics"], a: 1 }
    ],
    medium: [
      { q: "Who won the 2022 Men's World Cup?", o: ["France","Brazil","Argentina","Germany"], a: 2 },
      { q: "Which country has won the most World Cups?", o: ["Germany","Italy","Argentina","Brazil"], a: 3 },
      { q: "What does VAR stand for?", o: ["Video Assistant Referee","Very Angry Ref","Visual Area Review","Video Action Replay"], a: 0 },
      { q: "Which club does Erling Haaland play for (2024)?", o: ["Real Madrid","Man City","Liverpool","Bayern Munich"], a: 1 },
      { q: "Where is the penalty spot located?", o: ["6 yards","12 yards","18 yards","Halfway"], a: 1 },
      { q: "A corner kick is taken when:", o: ["Defense kicks ball over goal line","Attack kicks ball over goal line","Ball goes over side line","A foul occurs"], a: 0 },
      { q: "Which player is known as 'The Flea' (La Pulga)?", o: ["Ronaldo","Neymar","Messi","Mbappe"], a: 2 }
    ],
    hard: [
      { q: "Which country hosted the 2010 World Cup?", o: ["Brazil","Germany","South Africa","Russia"], a: 2 },
      { q: "Who is the all-time top scorer for Portugal?", o: ["Figo","Eusebio","Ronaldo","Deco"], a: 2 },
      { q: "What is a 'False 9'?", o: ["A bad referee","A striker who drops deep","A goalkeeper who scores","A defender who attacks"], a: 1 },
      { q: "Which team is nicknamed 'The Red Devils'?", o: ["Liverpool","Arsenal","Man Utd","Bayern Munich"], a: 2 },
      { q: "Who won the first ever World Cup in 1930?", o: ["Brazil","Italy","Uruguay","Argentina"], a: 2 },
      { q: "How many teams play in the English Premier League?", o: ["18","20","22","24"], a: 1 },
      { q: "The 'Ballon d'Or' is awarded to:", o: ["Best Goalkeeper","Best Young Player","Best Player of the Year","Top Scorer"], a: 2 }
    ]
  },
  trivia: {
    easy: [
      { q: "What is the fastest land animal?", o: ["Lion","Horse","Cheetah","Leopard"], a: 2 },
      { q: "Which fruit is yellow and curved?", o: ["Apple","Banana","Orange","Pear"], a: 1 },
      { q: "What is the capital of France?", o: ["London","Berlin","Rome","Paris"], a: 3 },
      { q: "How many days in a Leap Year?", o: ["364","365","366","367"], a: 2 },
      { q: "Who lives in a pineapple under the sea?", o: ["Patrick","SpongeBob","Squidward","Sandy"], a: 1 },
      { q: "Which superhero climbs walls?", o: ["Batman","Superman","Spider-Man","Iron Man"], a: 2 },
      { q: "What do bees make?", o: ["Milk","Jam","Honey","Syrup"], a: 2 }
    ],
    medium: [
      { q: "Which country invented pizza?", o: ["USA","France","Italy","Spain"], a: 2 },
      { q: "What is the largest ocean?", o: ["Atlantic","Indian","Arctic","Pacific"], a: 3 },
      { q: "Who wrote 'Harry Potter'?", o: ["Roald Dahl","J.K. Rowling","C.S. Lewis","J.R.R. Tolkien"], a: 1 },
      { q: "What is the currency of Japan?", o: ["Dollar","Euro","Yen","Won"], a: 2 },
      { q: "Which famous ship sank in 1912?", o: ["Titanic","Lusitania","Santa Maria","Mayflower"], a: 0 },
      { q: "How many continents are there?", o: ["5","6","7","8"], a: 2 },
      { q: "What is the hardest material in the human body?", o: ["Bone","Nail","Tooth Enamel","Skin"], a: 2 }
    ],
    hard: [
      { q: "What is the smallest country in the world?", o: ["Monaco","Malta","Vatican City","San Marino"], a: 2 },
      { q: "Which year did World War II end?", o: ["1943","1944","1945","1946"], a: 2 },
      { q: "What is the capital of Canada?", o: ["Toronto","Vancouver","Montreal","Ottawa"], a: 3 },
      { q: "Who painted the Mona Lisa?", o: ["Van Gogh","Picasso","Da Vinci","Michelangelo"], a: 2 },
      { q: "How many keys are on a standard piano?", o: ["66","77","88","99"], a: 2 },
      { q: "Which element has the symbol 'O'?", o: ["Gold","Oxygen","Osmium","Orange"], a: 1 },
      { q: "In Greek mythology, who is the King of Gods?", o: ["Poseidon","Hades","Apollo","Zeus"], a: 3 }
    ]
  },
  flags: {
    easy: [
      { q: "Which country is this? ðŸ‡ºðŸ‡¸", o: ["UK","USA","France","Canada"], a: 1, big: true },
      { q: "Which country is this? ðŸ‡¨ðŸ‡¦", o: ["Canada","Japan","Peru","Austria"], a: 0, big: true },
      { q: "Which country is this? ðŸ‡¯ðŸ‡µ", o: ["China","Korea","Japan","Vietnam"], a: 2, big: true },
      { q: "Which country is this? ðŸ‡¬ðŸ‡§", o: ["Australia","USA","UK","New Zealand"], a: 2, big: true },
      { q: "Which country is this? ðŸ‡«ðŸ‡·", o: ["Italy","Russia","Netherlands","France"], a: 3, big: true },
      { q: "Which country is this? ðŸ‡®ðŸ‡¹", o: ["Mexico","Italy","Hungary","Ireland"], a: 1, big: true },
      { q: "Which country is this? ðŸ‡©ðŸ‡ª", o: ["Belgium","Germany","Poland","Netherlands"], a: 1, big: true },
      { q: "Which country is this? ðŸ‡¨ðŸ‡³", o: ["Vietnam","Turkey","China","Spain"], a: 2, big: true },
      { q: "Which country is this? ðŸ‡¦ðŸ‡º", o: ["UK","New Zealand","Fiji","Australia"], a: 3, big: true },
      { q: "Which country is this? ðŸ‡§ðŸ‡·", o: ["Argentina","Brazil","Chile","Portugal"], a: 1, big: true }
    ],
    medium: [
      { q: "Which country is this? ðŸ‡ªðŸ‡¸", o: ["Portugal","Spain","Italy","Greece"], a: 1, big: true },
      { q: "Which country is this? ðŸ‡°ðŸ‡·", o: ["Japan","North Korea","South Korea","Thailand"], a: 2, big: true },
      { q: "Which country is this? ðŸ‡®ðŸ‡³", o: ["India","Ireland","Iran","Indonesia"], a: 0, big: true },
      { q: "Which country is this? ðŸ‡¨ðŸ‡­", o: ["Sweden","Switzerland","Norway","Denmark"], a: 1, big: true },
      { q: "Which country is this? ðŸ‡¬ðŸ‡·", o: ["Cyprus","Israel","Greece","Finland"], a: 2, big: true },
      { q: "Which country is this? ðŸ‡¦ðŸ‡·", o: ["Uruguay","Argentina","Brazil","Paraguay"], a: 1, big: true },
      { q: "Which country is this? ðŸ‡¿ðŸ‡¦", o: ["Kenya","Nigeria","Ghana","South Africa"], a: 3, big: true },
      { q: "Which country is this? ðŸ‡¸ðŸ‡ª", o: ["Sweden","Norway","Finland","Denmark"], a: 0, big: true },
      { q: "Which country is this? ðŸ‡¹ðŸ‡·", o: ["Tunisia","Turkey","Pakistan","Morocco"], a: 1, big: true },
      { q: "Which country is this? ðŸ‡²ðŸ‡½", o: ["Italy","Mexico","Ireland","Iran"], a: 1, big: true }
    ],
    hard: [
      { q: "Which country is this? ðŸ‡³ðŸ‡µ", o: ["Nepal","Bhutan","India","Tibet"], a: 0, big: true },
      { q: "Which country is this? ðŸ‡ªðŸ‡¬", o: ["Syria","Iraq","Egypt","Yemen"], a: 2, big: true },
      { q: "Which country is this? ðŸ‡³ðŸ‡¿", o: ["Australia","UK","Fiji","New Zealand"], a: 3, big: true },
      { q: "Which country is this? ðŸ‡µðŸ‡¹", o: ["Spain","Brazil","Portugal","Belarus"], a: 2, big: true },
      { q: "Which country is this? ðŸ‡³ðŸ‡¬", o: ["Nigeria","Niger","Kenya","Zimbabwe"], a: 0, big: true },
      { q: "Which country is this? ðŸ‡»ðŸ‡³", o: ["China","Vietnam","Morocco","Turkey"], a: 1, big: true },
      { q: "Which country is this? ðŸ‡«ðŸ‡®", o: ["Norway","Sweden","Finland","Iceland"], a: 2, big: true },
      { q: "Which country is this? ðŸ‡®ðŸ‡±", o: ["Israel","Greece","Cyprus","Jordan"], a: 0, big: true },
      { q: "Which country is this? ðŸ‡¸ðŸ‡¦", o: ["UAE","Saudi Arabia","Oman","Qatar"], a: 1, big: true },
      { q: "Which country is this? ðŸ‡¨ðŸ‡±", o: ["Texas","Chile","Cuba","Puerto Rico"], a: 1, big: true }
    ]
  },
  kotlc: {
    easy: [
      { q: "Who is Sophie's bodyguard?", o: ["Ro","Bo","Sandor","Grizel"], a: 2 },
      { q: "What color is a Registry pendant?", o: ["Gold","Silver","Crystal","Black"], a: 2 },
      { q: "What animal is Iggy?", o: ["Imp","Gremlin","Gnome","Murcat"], a: 0 },
      { q: "Which word is a NOUN? 'Dex fixed the gadget.'", o: ["Dex","Fixed","The","Fast"], a: 0 },
      { q: "Grammar: 'Sophie ___ to Foxfire yesterday.'", o: ["Go","Gone","Went","Going"], a: 2 },
      { q: "Inference: 'Fitz stomped his foot and crossed his arms.' He is:", o: ["Happy","Angry","Sleepy","Cold"], a: 1 },
      { q: "What is Keefe's favorite thing to do?", o: ["Study","Skip school","Clean his room","Follow rules"], a: 1 },
      { q: "Who is Biana's brother?", o: ["Keefe","Dex","Fitz","Tam"], a: 2 },
      { q: "What color are Sophie's eyes?", o: ["Blue","Green","Brown","Gold"], a: 2 }
    ],
    medium: [
      { q: "What is the name of the Black Swan's collective?", o: ["The Forkle","The Collective","The Neverseen","The Council"], a: 1 },
      { q: "Grammar: Identify the ADJECTIVE. 'Keefe has messy hair.'", o: ["Keefe","Has","Messy","Hair"], a: 2 },
      { q: "Inference: 'Biana vanished the moment she saw the mess.' She is:", o: ["Brave","Helpful","Avoiding trouble","Tired"], a: 2 },
      { q: "What ability does Tam have?", o: ["Hydrokinetic","Shade","Flasher","Mesmer"], a: 1 },
      { q: "What is the capital of the Elvin world?", o: ["Eternalia","Atlantis","Lumenaria","Ravagog"], a: 0 },
      { q: "Grammar: '___ going to the healing center.'", o: ["There","Their","They're","They"], a: 2 },
      { q: "Who is the Councillor of Empathy?", o: ["Oralie","Kenric","Bronte","Alina"], a: 0 },
      { q: "Inference: 'Dex checked the lock three times.' He is being:", o: ["Careless","Cautious","Silly","Rude"], a: 1 },
      { q: "Which twin is the Hydrokinetic?", o: ["Tam","Linh","Biana","Marella"], a: 1 }
    ],
    hard: [
      { q: "What is the name of Sophie's biological mother?", o: ["Edaline","Oralie","Vespera","Gisela"], a: 1 },
      { q: "Grammar: 'The alicorn flew ___ the clouds.' (Preposition)", o: ["Above","Red","Fast","Bird"], a: 0 },
      { q: "Inference: 'Sandor's voice went up an octave.' He is:", o: ["Relaxed","Happy","Panicked/Stressed","Asleep"], a: 2 },
      { q: "What represents the Neverseen?", o: ["A Swan","A Eye","A Hand","A Star"], a: 1 },
      { q: "Grammar: Which sentence is correct?", o: ["Keefe runned fast.","Keefe ran fast.","Keefe run fast.","Keefe running fast."], a: 1 },
      { q: "Who killed Councillor Kenric?", o: ["Fintan","Brant","Gethen","Ruy"], a: 0 },
      { q: "Inference: 'Sophie tugged out a loose eyelash.' She is:", o: ["Bored","Anxious/Nervous","Excited","Cold"], a: 1 },
      { q: "What is the substance that suppresses abilities?", o: ["Quintessence","Limpkins","Melder","Ability Restrictor"], a: 3 },
      { q: "Grammar: 'Silveny is the ___ alicorn in the world.'", o: ["Sparkly","Sparklier","Sparkliest","Sparkle"], a: 2 }
    ]
  },
  english: {
    easy: [
      { q: "Which word is a verb? 'The dog ran fast.'", o: ["The","Dog","Ran","Fast"], a: 2 },
      { q: "Plural of 'Mouse'?", o: ["Mouses","Mice","Mic","Mices"], a: 1 },
      { q: "Opposite of 'Difficult'?", o: ["Hard","Easy","Complex","Tough"], a: 1 },
      { q: "Rhymes with 'Blue'?", o: ["Blow","Shoe","Slow","Cow"], a: 1 },
      { q: "Choose the correct spelling:", o: ["Frend","Freind","Friend","Frind"], a: 2 }
    ],
    medium: [
      { q: "Identify the Adverb: 'He spoke softly.'", o: ["He","Spoke","Softly","None"], a: 2 },
      { q: "Past tense of 'Bring'?", o: ["Brang","Brought","Bringed","Bring"], a: 1 },
      { q: "A story about a person's life written by themself:", o: ["Biography","Autobiography","Fiction","Novel"], a: 1 },
      { q: "Which is a homophone for 'Sea'?", o: ["Say","See","Saw","Sue"], a: 1 },
      { q: "Choose the correct spelling:", o: ["Because","Becuse","Becuase","Beacuse"], a: 0 }
    ],
    hard: [
      { q: "What is a Simile?", o: ["Comparing using 'like' or 'as'","Giving human traits to objects","An exaggeration","A sound word"], a: 0 },
      { q: "Identify the Conjunction: 'I wanted to go, but I was tired.'", o: ["Wanted","Go","But","Tired"], a: 2 },
      { q: "Which word means 'Very happy'?", o: ["Melancholy","Ecstatic","Fatigued","Indifferent"], a: 1 },
      { q: "Choose the correct spelling:", o: ["Neccessary","Necesary","Necessary","Neccesary"], a: 2 },
      { q: "'The wind howled' is an example of:", o: ["Metaphor","Personification","Alliteration","Simile"], a: 1 }
    ]
  }
};

        // ==================== GAME DATA ====================
        const PRIZE_LADDER = [
          { level: 1, amount: 100 }, { level: 2, amount: 200 }, { level: 3, amount: 300 },
          { level: 4, amount: 400 }, { level: 5, amount: 500 }, { level: 6, amount: 1000, safe: true },
          { level: 7, amount: 2000 }, { level: 8, amount: 4000 }, { level: 9, amount: 8000 },
          { level: 10, amount: 16000 }, { level: 11, amount: 32000, safe: true },
          { level: 12, amount: 64000 }, { level: 13, amount: 125000 }, { level: 14, amount: 250000 },
          { level: 15, amount: 1000000 },
        ];

        const CATEGORIES = [
          { id: 'math', name: 'Math', icon: 'ðŸ§®', color: 'from-blue-500 to-blue-600' },
          { id: 'science', name: 'Science', icon: 'ðŸ”¬', color: 'from-green-500 to-green-600' },
          { id: 'kotlc', name: 'KOTLC', icon: 'âœ¨', color: 'from-purple-500 to-purple-600' },
          { id: 'soccer', name: 'Soccer', icon: 'âš½', color: 'from-emerald-500 to-emerald-600' },
          { id: 'english', name: 'English', icon: 'ðŸ“–', color: 'from-orange-500 to-orange-600' },
          { id: 'trivia', name: 'Trivia', icon: 'ðŸ§ ', color: 'from-pink-500 to-pink-600' },
          { id: 'flags', name: 'Flags', icon: 'ðŸš©', color: 'from-red-500 to-red-600' },
        ];

        // ==================== ITEM GRAPHICS ====================
        const ItemGraphic = ({ itemId, size = 40, style = {} }) => {
          const s = size;
          
          const graphics = {
            // HEADS
            crown: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <polygon points="5,35 8,15 14,25 20,10 26,25 32,15 35,35" fill="#FFD700" stroke="#DAA520" strokeWidth="2"/>
                <circle cx="8" cy="15" r="3" fill="#e74c3c"/>
                <circle cx="20" cy="10" r="3" fill="#3498db"/>
                <circle cx="32" cy="15" r="3" fill="#2ecc71"/>
              </svg>
            ),
            tophat: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <rect x="8" y="25" width="24" height="8" fill="#1a1a1a" rx="2"/>
                <rect x="12" y="8" width="16" height="20" fill="#2c3e50"/>
                <rect x="12" y="18" width="16" height="3" fill="#c0392b"/>
              </svg>
            ),
            cap: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <ellipse cx="20" cy="28" rx="15" ry="8" fill="#e74c3c"/>
                <path d="M5 28 Q20 15 35 28" fill="#c0392b"/>
                <rect x="5" y="26" width="20" height="6" fill="#c0392b" rx="2"/>
              </svg>
            ),
            helmet: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <ellipse cx="20" cy="25" rx="14" ry="12" fill="#8B4513"/>
                <rect x="18" y="5" width="4" height="15" fill="#95a5a6"/>
                <ellipse cx="20" cy="5" rx="3" ry="2" fill="#bdc3c7"/>
                <path d="M8 20 Q20 30 32 20" fill="none" stroke="#DAA520" strokeWidth="2"/>
              </svg>
            ),
            wizardhat: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <polygon points="20,2 5,38 35,38" fill="#9b59b6"/>
                <ellipse cx="20" cy="36" rx="16" ry="4" fill="#8e44ad"/>
                <circle cx="15" cy="20" r="2" fill="#f1c40f"/>
                <circle cx="25" cy="28" r="2" fill="#f1c40f"/>
                <circle cx="20" cy="12" r="2" fill="#f1c40f"/>
              </svg>
            ),
            // FACE
            glasses: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <circle cx="12" cy="20" r="8" fill="none" stroke="#1a1a1a" strokeWidth="3"/>
                <circle cx="28" cy="20" r="8" fill="none" stroke="#1a1a1a" strokeWidth="3"/>
                <line x1="20" y1="20" x2="20" y2="20" stroke="#1a1a1a" strokeWidth="3"/>
                <line x1="4" y1="18" x2="4" y2="22" stroke="#1a1a1a" strokeWidth="2"/>
                <line x1="36" y1="18" x2="36" y2="22" stroke="#1a1a1a" strokeWidth="2"/>
              </svg>
            ),
            sunglasses: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <rect x="4" y="15" width="14" height="10" fill="#1a1a1a" rx="3"/>
                <rect x="22" y="15" width="14" height="10" fill="#1a1a1a" rx="3"/>
                <rect x="18" y="18" width="4" height="4" fill="#1a1a1a"/>
              </svg>
            ),
            monocle: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <circle cx="20" cy="18" r="10" fill="none" stroke="#DAA520" strokeWidth="3"/>
                <line x1="20" y1="28" x2="20" y2="38" stroke="#DAA520" strokeWidth="2"/>
              </svg>
            ),
            // WEAPONS
            sword: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <rect x="18" y="2" width="4" height="25" fill="#95a5a6"/>
                <polygon points="15,2 20,0 25,2 20,5" fill="#bdc3c7"/>
                <rect x="12" y="27" width="16" height="4" fill="#8B4513"/>
                <rect x="17" y="31" width="6" height="8" fill="#8B4513"/>
                <circle cx="20" cy="29" r="2" fill="#e74c3c"/>
              </svg>
            ),
            shield: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <path d="M5 5 L35 5 L35 20 Q35 35 20 40 Q5 35 5 20 Z" fill="#8B4513" stroke="#DAA520" strokeWidth="2"/>
                <path d="M10 10 L30 10 L30 18 Q30 30 20 34 Q10 30 10 18 Z" fill="#c0392b"/>
                <path d="M20 12 L25 22 L20 20 L15 22 Z" fill="#f1c40f"/>
              </svg>
            ),
            bow: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <path d="M10 5 Q5 20 10 35" fill="none" stroke="#8B4513" strokeWidth="4"/>
                <line x1="10" y1="5" x2="10" y2="35" stroke="#95a5a6" strokeWidth="1"/>
                <line x1="10" y1="20" x2="35" y2="20" stroke="#8B4513" strokeWidth="2"/>
                <polygon points="35,17 40,20 35,23 33,20" fill="#95a5a6"/>
              </svg>
            ),
            wand: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <rect x="8" y="18" width="25" height="4" fill="#4a3728" rx="2"/>
                <circle cx="35" cy="20" r="5" fill="#9b59b6"/>
                <circle cx="35" cy="20" r="3" fill="#e74c3c"/>
                {[0,1,2,3,4,5].map(i => <line key={i} x1="35" y1="20" x2={35 + Math.cos(i*60*Math.PI/180)*8} y2={20 + Math.sin(i*60*Math.PI/180)*8} stroke="#f1c40f" strokeWidth="1"/>)}
              </svg>
            ),
            trident: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <rect x="18" y="15" width="4" height="25" fill="#3498db"/>
                <rect x="8" y="8" width="24" height="4" fill="#3498db"/>
                <polygon points="10,8 10,2 12,8" fill="#95a5a6"/>
                <polygon points="18,8 20,0 22,8" fill="#95a5a6"/>
                <polygon points="28,8 30,2 32,8" fill="#95a5a6"/>
              </svg>
            ),
            hammer: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <rect x="18" y="18" width="4" height="22" fill="#8B4513"/>
                <rect x="8" y="5" width="24" height="15" fill="#7f8c8d" rx="2"/>
                <rect x="8" y="8" width="24" height="3" fill="#f1c40f"/>
              </svg>
            ),
            axe: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <rect x="18" y="15" width="4" height="25" fill="#8B4513"/>
                <path d="M10 5 Q5 15 15 20 L22 20 L22 5 Z" fill="#95a5a6" stroke="#7f8c8d" strokeWidth="1"/>
              </svg>
            ),
            dagger: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <polygon points="20,2 23,20 20,22 17,20" fill="#95a5a6"/>
                <rect x="15" y="22" width="10" height="4" fill="#4a3728"/>
                <rect x="17" y="26" width="6" height="10" fill="#2c3e50"/>
              </svg>
            ),
            scepter: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <rect x="18" y="15" width="4" height="25" fill="#f1c40f"/>
                <circle cx="20" cy="10" r="8" fill="#9b59b6" stroke="#f1c40f" strokeWidth="2"/>
                <circle cx="20" cy="10" r="4" fill="#e74c3c"/>
              </svg>
            ),
            staff: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <rect x="18" y="10" width="4" height="30" fill="#8B4513"/>
                <circle cx="20" cy="8" r="6" fill="#3498db" stroke="#2980b9" strokeWidth="2"/>
                <circle cx="20" cy="8" r="2" fill="#ecf0f1"/>
              </svg>
            ),
            laser: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <rect x="5" y="15" width="25" height="10" fill="#2c3e50" rx="2"/>
                <rect x="30" y="17" width="8" height="6" fill="#e74c3c"/>
                <circle cx="15" cy="20" r="3" fill="#3498db"/>
              </svg>
            ),
            // BACK ITEMS
            cape: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <path d="M8 5 L32 5 L35 38 Q20 42 5 38 Z" fill="#c0392b"/>
                <path d="M8 5 L32 5 L32 10 L8 10 Z" fill="#e74c3c"/>
              </svg>
            ),
            wings: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <ellipse cx="12" cy="20" rx="10" ry="15" fill="#ecf0f1" stroke="#bdc3c7" strokeWidth="1"/>
                <ellipse cx="28" cy="20" rx="10" ry="15" fill="#ecf0f1" stroke="#bdc3c7" strokeWidth="1"/>
                <ellipse cx="10" cy="20" rx="6" ry="10" fill="#fff"/>
                <ellipse cx="30" cy="20" rx="6" ry="10" fill="#fff"/>
              </svg>
            ),
            // NECK
            scarf: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <rect x="5" y="10" width="30" height="8" fill="#3498db" rx="2"/>
                <rect x="25" y="18" width="8" height="20" fill="#3498db" rx="2"/>
                <line x1="27" y1="20" x2="27" y2="36" stroke="#2980b9" strokeWidth="1"/>
                <line x1="31" y1="20" x2="31" y2="36" stroke="#2980b9" strokeWidth="1"/>
              </svg>
            ),
            bowtie: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <polygon points="5,15 18,20 5,25" fill="#e74c3c"/>
                <polygon points="35,15 22,20 35,25" fill="#e74c3c"/>
                <circle cx="20" cy="20" r="4" fill="#c0392b"/>
              </svg>
            ),
            medal: (
              <svg width={s} height={s} viewBox="0 0 40 40" style={style}>
                <rect x="15" y="2" width="10" height="15" fill="#3498db"/>
                <circle cx="20" cy="28" r="10" fill="#f1c40f" stroke="#DAA520" strokeWidth="2"/>
                <text x="20" y="32" textAnchor="middle" fontSize="10" fill="#DAA520">â˜…</text>
              </svg>
            ),
            // SHIRTS
            shirt_red: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><rect x="8" y="5" width="24" height="30" fill="#e74c3c" rx="3"/><rect x="2" y="5" width="8" height="15" fill="#e74c3c" rx="2"/><rect x="30" y="5" width="8" height="15" fill="#e74c3c" rx="2"/></svg>,
            shirt_blue: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><rect x="8" y="5" width="24" height="30" fill="#3498db" rx="3"/><rect x="2" y="5" width="8" height="15" fill="#3498db" rx="2"/><rect x="30" y="5" width="8" height="15" fill="#3498db" rx="2"/></svg>,
            shirt_green: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><rect x="8" y="5" width="24" height="30" fill="#2ecc71" rx="3"/><rect x="2" y="5" width="8" height="15" fill="#2ecc71" rx="2"/><rect x="30" y="5" width="8" height="15" fill="#2ecc71" rx="2"/></svg>,
            shirt_purple: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><rect x="8" y="5" width="24" height="30" fill="#9b59b6" rx="3"/><rect x="2" y="5" width="8" height="15" fill="#9b59b6" rx="2"/><rect x="30" y="5" width="8" height="15" fill="#9b59b6" rx="2"/></svg>,
            shirt_gold: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><rect x="8" y="5" width="24" height="30" fill="#f1c40f" rx="3"/><rect x="2" y="5" width="8" height="15" fill="#f1c40f" rx="2"/><rect x="30" y="5" width="8" height="15" fill="#f1c40f" rx="2"/></svg>,
            shirt_white: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><rect x="8" y="5" width="24" height="30" fill="#ecf0f1" rx="3"/><rect x="2" y="5" width="8" height="15" fill="#ecf0f1" rx="2"/><rect x="30" y="5" width="8" height="15" fill="#ecf0f1" rx="2"/></svg>,
            // PANTS
            pants_blue: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><rect x="8" y="2" width="10" height="36" fill="#2980b9" rx="2"/><rect x="22" y="2" width="10" height="36" fill="#2980b9" rx="2"/><rect x="8" y="2" width="24" height="10" fill="#2980b9"/></svg>,
            pants_black: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><rect x="8" y="2" width="10" height="36" fill="#2c3e50" rx="2"/><rect x="22" y="2" width="10" height="36" fill="#2c3e50" rx="2"/><rect x="8" y="2" width="24" height="10" fill="#2c3e50"/></svg>,
            pants_brown: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><rect x="8" y="2" width="10" height="36" fill="#8B4513" rx="2"/><rect x="22" y="2" width="10" height="36" fill="#8B4513" rx="2"/><rect x="8" y="2" width="24" height="10" fill="#8B4513"/></svg>,
            pants_beige: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><rect x="8" y="2" width="10" height="36" fill="#D2B48C" rx="2"/><rect x="22" y="2" width="10" height="36" fill="#D2B48C" rx="2"/><rect x="8" y="2" width="24" height="10" fill="#D2B48C"/></svg>,
            // SHOES
            shoes_red: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><ellipse cx="12" cy="25" rx="10" ry="6" fill="#c0392b"/><ellipse cx="28" cy="25" rx="10" ry="6" fill="#c0392b"/></svg>,
            shoes_white: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><ellipse cx="12" cy="25" rx="10" ry="6" fill="#ecf0f1"/><ellipse cx="28" cy="25" rx="10" ry="6" fill="#ecf0f1"/><ellipse cx="12" cy="23" rx="8" ry="4" fill="#bdc3c7"/><ellipse cx="28" cy="23" rx="8" ry="4" fill="#bdc3c7"/></svg>,
            shoes_gold: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><ellipse cx="12" cy="25" rx="10" ry="6" fill="#f1c40f"/><ellipse cx="28" cy="25" rx="10" ry="6" fill="#f1c40f"/></svg>,
            shoes_black: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><ellipse cx="12" cy="25" rx="10" ry="6" fill="#1a1a1a"/><ellipse cx="28" cy="25" rx="10" ry="6" fill="#1a1a1a"/></svg>,
            shoes_brown: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><ellipse cx="12" cy="25" rx="10" ry="6" fill="#8B4513"/><ellipse cx="28" cy="25" rx="10" ry="6" fill="#8B4513"/></svg>,
            // Additional shirts
            shirt_gray: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><rect x="8" y="5" width="24" height="30" fill="#95a5a6" rx="3"/><rect x="2" y="5" width="8" height="15" fill="#95a5a6" rx="2"/><rect x="30" y="5" width="8" height="15" fill="#95a5a6" rx="2"/></svg>,
            // Additional pants
            pants_gray: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><rect x="8" y="2" width="10" height="36" fill="#7f8c8d" rx="2"/><rect x="22" y="2" width="10" height="36" fill="#7f8c8d" rx="2"/><rect x="8" y="2" width="24" height="10" fill="#7f8c8d"/></svg>,
            pants_khaki: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><rect x="8" y="2" width="10" height="36" fill="#d4ac6e" rx="2"/><rect x="22" y="2" width="10" height="36" fill="#d4ac6e" rx="2"/><rect x="8" y="2" width="24" height="10" fill="#d4ac6e"/></svg>,
            // HAIR
            hair_brown: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><ellipse cx="20" cy="15" rx="15" ry="12" fill="#4a3728"/><ellipse cx="20" cy="20" rx="12" ry="8" fill="#FFDAB9"/></svg>,
            hair_black: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><ellipse cx="20" cy="15" rx="15" ry="12" fill="#1a1a1a"/><ellipse cx="20" cy="20" rx="12" ry="8" fill="#FFDAB9"/></svg>,
            hair_blonde: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><ellipse cx="20" cy="15" rx="15" ry="12" fill="#f1c40f"/><ellipse cx="20" cy="20" rx="12" ry="8" fill="#FFDAB9"/></svg>,
            hair_red: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><ellipse cx="20" cy="15" rx="15" ry="12" fill="#e74c3c"/><ellipse cx="20" cy="20" rx="12" ry="8" fill="#FFDAB9"/></svg>,
            hair_blue: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><ellipse cx="20" cy="15" rx="15" ry="12" fill="#3498db"/><ellipse cx="20" cy="20" rx="12" ry="8" fill="#FFDAB9"/></svg>,
            hair_pink: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><ellipse cx="20" cy="15" rx="15" ry="12" fill="#e91e63"/><ellipse cx="20" cy="20" rx="12" ry="8" fill="#FFDAB9"/></svg>,
            // EYES
            eyes_normal: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><circle cx="14" cy="20" r="4" fill="#1a1a1a"/><circle cx="26" cy="20" r="4" fill="#1a1a1a"/><circle cx="15" cy="19" r="1" fill="#fff"/><circle cx="27" cy="19" r="1" fill="#fff"/></svg>,
            eyes_happy: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><path d="M10 20 Q14 16 18 20" fill="none" stroke="#1a1a1a" strokeWidth="3"/><path d="M22 20 Q26 16 30 20" fill="none" stroke="#1a1a1a" strokeWidth="3"/></svg>,
            eyes_cool: <svg width={s} height={s} viewBox="0 0 40 40" style={style}><rect x="8" y="17" width="10" height="6" fill="#1a1a1a"/><rect x="22" y="17" width="10" height="6" fill="#1a1a1a"/></svg>,
          };
          
          return graphics[itemId] || <div style={{width: s, height: s, background: '#ccc', borderRadius: 4}} />;
        };

        // PRICES CUT BY 80% + FREE ITEMS
        const SHOP_ITEMS = {
          outfits: [
            // FREE HAIR (always available)
            { id: 'hair_brown', name: 'Brown Hair', price: 0, type: 'hair', color: '#4a3728', free: true },
            { id: 'hair_black', name: 'Black Hair', price: 0, type: 'hair', color: '#1a1a1a', free: true },
            { id: 'hair_blonde', name: 'Blonde Hair', price: 0, type: 'hair', color: '#f1c40f', free: true },
            { id: 'hair_red', name: 'Red Hair', price: 0, type: 'hair', color: '#e74c3c', free: true },
            { id: 'hair_blue', name: 'Blue Hair', price: 0, type: 'hair', color: '#3498db', free: true },
            { id: 'hair_pink', name: 'Pink Hair', price: 0, type: 'hair', color: '#e91e63', free: true },
            // FREE FACES (always available)
            { id: 'eyes_normal', name: 'Normal Eyes', price: 0, type: 'face', color: '#000', free: true },
            { id: 'eyes_happy', name: 'Happy Eyes', price: 0, type: 'face', color: '#000', free: true },
            { id: 'eyes_cool', name: 'Cool Eyes', price: 0, type: 'face', color: '#000', free: true },
            // FREE SHIRTS (always available)
            { id: 'shirt_white', name: 'White Shirt', price: 0, type: 'shirt', color: '#ecf0f1', free: true },
            { id: 'shirt_gray', name: 'Gray Shirt', price: 0, type: 'shirt', color: '#95a5a6', free: true },
            // FREE PANTS (always available)
            { id: 'pants_gray', name: 'Gray Pants', price: 0, type: 'pants', color: '#7f8c8d', free: true },
            { id: 'pants_khaki', name: 'Khaki Pants', price: 0, type: 'pants', color: '#d4ac6e', free: true },
            // FREE SHOES (always available)
            { id: 'shoes_black', name: 'Black Shoes', price: 0, type: 'shoes', color: '#1a1a1a', free: true },
            { id: 'shoes_brown', name: 'Brown Shoes', price: 0, type: 'shoes', color: '#8B4513', free: true },
            // PAID HEAD ITEMS
            { id: 'crown', name: 'Golden Crown', price: 1000000, type: 'head', color: '#FFD700' },
            { id: 'tophat', name: 'Top Hat', price: 400000, type: 'head', color: '#1a1a1a' },
            { id: 'cap', name: 'Baseball Cap', price: 160000, type: 'head', color: '#e74c3c' },
            { id: 'helmet', name: 'Viking Helmet', price: 600000, type: 'head', color: '#8B4513' },
            { id: 'wizardhat', name: 'Wizard Hat', price: 800000, type: 'head', color: '#9b59b6' },
            // PAID ACCESSORIES
            { id: 'glasses', name: 'Cool Glasses', price: 300000, type: 'accessory', color: '#1a1a1a' },
            { id: 'sunglasses', name: 'Sunglasses', price: 200000, type: 'accessory', color: '#2c3e50' },
            { id: 'monocle', name: 'Monocle', price: 500000, type: 'accessory', color: '#f1c40f' },
            // PAID BACK ITEMS
            { id: 'cape', name: 'Hero Cape', price: 2000000, type: 'back', color: '#e74c3c' },
            { id: 'wings', name: 'Angel Wings', price: 10000000, type: 'back', color: '#ecf0f1' },
            // PAID NECK ITEMS
            { id: 'scarf', name: 'Cozy Scarf', price: 200000, type: 'neck', color: '#3498db' },
            { id: 'bowtie', name: 'Fancy Bowtie', price: 160000, type: 'neck', color: '#e74c3c' },
            { id: 'medal', name: 'Gold Medal', price: 3000000, type: 'neck', color: '#f1c40f' },
            // PAID SHIRTS
            { id: 'shirt_red', name: 'Red Shirt', price: 100000, type: 'shirt', color: '#e74c3c' },
            { id: 'shirt_blue', name: 'Blue Shirt', price: 100000, type: 'shirt', color: '#3498db' },
            { id: 'shirt_green', name: 'Green Shirt', price: 100000, type: 'shirt', color: '#2ecc71' },
            { id: 'shirt_purple', name: 'Purple Shirt', price: 150000, type: 'shirt', color: '#9b59b6' },
            { id: 'shirt_gold', name: 'Golden Shirt', price: 500000, type: 'shirt', color: '#f1c40f' },
            // PAID PANTS
            { id: 'pants_blue', name: 'Blue Pants', price: 80000, type: 'pants', color: '#2980b9' },
            { id: 'pants_black', name: 'Black Pants', price: 80000, type: 'pants', color: '#2c3e50' },
            { id: 'pants_brown', name: 'Brown Pants', price: 80000, type: 'pants', color: '#8B4513' },
            // PAID SHOES
            { id: 'shoes_red', name: 'Red Shoes', price: 60000, type: 'shoes', color: '#c0392b' },
            { id: 'shoes_white', name: 'White Sneakers', price: 60000, type: 'shoes', color: '#ecf0f1' },
            { id: 'shoes_gold', name: 'Golden Shoes', price: 400000, type: 'shoes', color: '#f1c40f' },
          ],
          weapons: [
            { id: 'sword', name: 'Magic Sword', price: 800000, color: '#95a5a6' },
            { id: 'shield', name: 'Knight Shield', price: 600000, color: '#8B4513' },
            { id: 'bow', name: 'Elven Bow', price: 1000000, color: '#8B4513' },
            { id: 'wand', name: 'Wizard Wand', price: 1200000, color: '#9b59b6' },
            { id: 'trident', name: 'Sea Trident', price: 2400000, color: '#3498db' },
            { id: 'hammer', name: 'Thunder Hammer', price: 3000000, color: '#7f8c8d' },
            { id: 'staff', name: 'Power Staff', price: 4000000, color: '#f1c40f' },
            { id: 'axe', name: 'Battle Axe', price: 1500000, color: '#7f8c8d' },
            { id: 'dagger', name: 'Shadow Dagger', price: 500000, color: '#2c3e50' },
          ],
          pets: [
            { id: 'dog', name: 'Loyal Dog', price: 400000, color: '#D2691E', sounds: ['Woof!', 'Bark bark!', 'Arf!'], thoughts: ['I love my human!', 'Is that food?', 'Walk time?', 'Best day ever!'] },
            { id: 'cat', name: 'Cute Cat', price: 400000, color: '#FFA500', sounds: ['Meow!', 'Purrrr', 'Mrrp?'], thoughts: ['I own this place', 'Nap time...', 'Pet me NOW', 'Ignore the human'] },
            { id: 'bunny', name: 'Fluffy Bunny', price: 300000, color: '#ecf0f1', sounds: ['*nose twitch*', '*hop hop*', '*munch*'], thoughts: ['Carrots!', 'So fluffy', 'Hop hop hop!', 'Ears up!'] },
            { id: 'dragon', name: 'Baby Dragon', price: 15000000, color: '#e74c3c', sounds: ['*tiny roar*', 'Rawr!', '*smoke puff*'], thoughts: ['Fire is fun!', 'I\'m not THAT small', 'Treasure?', 'Fear me!'] },
            { id: 'unicorn', name: 'Magic Unicorn', price: 20000000, color: '#ecf0f1', sounds: ['*magical neigh*', '*sparkles*', '*whinny*'], thoughts: ['So majestic', 'Rainbow time!', 'Magic is real', 'Glitter!'] },
            { id: 'phoenix', name: 'Phoenix', price: 30000000, color: '#e67e22', sounds: ['*beautiful cry*', '*flames crackle*', '*soaring sound*'], thoughts: ['Rise from ashes!', 'So warm~', 'Eternal flame', 'Rebirth!'] },
            { id: 'owl', name: 'Wise Owl', price: 1000000, color: '#8B4513', sounds: ['Hoo hoo!', 'Who?', '*wise hoot*'], thoughts: ['I know things', 'Night time!', 'Books are good', 'Wisdom!'] },
            { id: 'turtle', name: 'Slow Turtle', price: 200000, color: '#2ecc71', sounds: ['...', '*slow blink*', '*munch*'], thoughts: ['Slow and steady', 'Shell is cozy', 'Lettuce?', 'No rush...'] },
          ],
          furniture: [
            { id: 'bed', name: 'Cozy Bed', price: 1600000, canSit: true },
            { id: 'couch', name: 'Comfy Couch', price: 2000000, canSit: true },
            { id: 'chair', name: 'Gaming Chair', price: 800000, canSit: true },
            { id: 'tv', name: 'Big Screen TV', price: 4000000 },
            { id: 'computer', name: 'Gaming PC', price: 6000000 },
            { id: 'bookshelf', name: 'Bookshelf', price: 1200000 },
            { id: 'piano', name: 'Grand Piano', price: 15000000 },
            { id: 'aquarium', name: 'Fish Tank', price: 3600000 },
            { id: 'fireplace', name: 'Fireplace', price: 5000000 },
            { id: 'trophy', name: 'Trophy Case', price: 7000000 },
            { id: 'plant', name: 'House Plant', price: 200000 },
            { id: 'lamp', name: 'Magic Lamp', price: 400000 },
            { id: 'turtle_fountain', name: 'Giant Turtle Fountain', price: 1 },
          ],
          rooms: [
            { id: 'bedroom', name: 'Bedroom', price: 15000000 },
            { id: 'gaming', name: 'Gaming Room', price: 20000000 },
            { id: 'kitchen', name: 'Kitchen', price: 16000000 },
            { id: 'library', name: 'Library', price: 24000000 },
            { id: 'garden', name: 'Garden', price: 30000000 },
            { id: 'pool', name: 'Pool Room', price: 50000000 },
          ],
          wallpapers: [
            { id: 'wall_blue', name: 'Blue Wallpaper', price: 100000, color: '#3498db' },
            { id: 'wall_pink', name: 'Pink Wallpaper', price: 100000, color: '#e91e63' },
            { id: 'wall_green', name: 'Green Wallpaper', price: 100000, color: '#2ecc71' },
            { id: 'wall_purple', name: 'Purple Wallpaper', price: 150000, color: '#9b59b6' },
            { id: 'wall_gold', name: 'Gold Wallpaper', price: 500000, color: '#f1c40f' },
            { id: 'wall_rainbow', name: 'Rainbow Wallpaper', price: 1000000, color: 'linear-gradient(90deg, red, orange, yellow, green, blue, purple)' },
          ],
          floors: [
            { id: 'floor_wood', name: 'Wooden Floor', price: 100000, color: '#8B4513' },
            { id: 'floor_marble', name: 'Marble Floor', price: 300000, color: '#ecf0f1' },
            { id: 'floor_carpet', name: 'Red Carpet', price: 200000, color: '#c0392b' },
            { id: 'floor_tile', name: 'Tile Floor', price: 150000, color: '#bdc3c7' },
            { id: 'floor_gold', name: 'Golden Floor', price: 2000000, color: '#f1c40f' },
          ],
        };

        const formatMoney = (n) => {
          if (n >= 1e9) return `$${(n/1e9).toFixed(1)}B`;
          if (n >= 1e6) return `$${(n/1e6).toFixed(1)}M`;
          if (n >= 1e3) return `$${(n/1e3).toFixed(0)}K`;
          return `$${n.toLocaleString()}`;
        };

        const PixelCharacter = ({ equipped = {}, itemPositions = {}, size = 100, style = {} }) => {
          const s = size;
          const scale = s / 100;
          
          const skinColor = '#FFDAB9';
          
          // Get hair color from equipped items (SHOP_ITEMS now includes free items)
          const hairItem = equipped.hair && SHOP_ITEMS.outfits.find(i => i.id === equipped.hair);
          const hairColor = hairItem?.color || '#4a3728';
          
          // Get clothing colors
          const shirtItem = equipped.shirt && SHOP_ITEMS.outfits.find(i => i.id === equipped.shirt);
          const pantsItem = equipped.pants && SHOP_ITEMS.outfits.find(i => i.id === equipped.pants);
          const shoesItem = equipped.shoes && SHOP_ITEMS.outfits.find(i => i.id === equipped.shoes);
          
          const shirtColor = shirtItem?.color || '#3498db';
          const pantsColor = pantsItem?.color || '#2c3e50';
          const shoeColor = shoesItem?.color || '#1a1a1a';
          
          // Default positions for items (percentage based)
          const defaultPos = {
            head: { x: 50, y: 0 },
            face: { x: 50, y: 18 },
            accessory: { x: 50, y: 18 },
            neck: { x: 50, y: 32 },
            back: { x: 50, y: 45 },
            weapon: { x: 90, y: 50 },
          };
          
          const getPos = (type) => {
            const custom = itemPositions[type];
            const def = defaultPos[type] || { x: 50, y: 50 };
            return { x: custom?.x ?? def.x, y: custom?.y ?? def.y };
          };
          
          return (
            <div style={{ width: s, height: s, position: 'relative', ...style }}>
              {/* Back items (cape/wings) - behind character */}
              {equipped.back && (
                <div style={{
                  position: 'absolute',
                  left: `${getPos('back').x}%`,
                  top: `${getPos('back').y}%`,
                  transform: 'translate(-50%, -50%)',
                  zIndex: 0
                }}>
                  <ItemGraphic itemId={equipped.back} size={40 * scale} />
                </div>
              )}
              
              {/* Hair */}
              <div style={{
                position: 'absolute', top: 2 * scale, left: '50%', transform: 'translateX(-50%)',
                width: 30 * scale, height: 18 * scale, background: hairColor,
                borderRadius: '50% 50% 0 0', zIndex: 1
              }} />
              
              {/* Head */}
              <div style={{
                position: 'absolute', top: 8 * scale, left: '50%', transform: 'translateX(-50%)',
                width: 28 * scale, height: 28 * scale, background: skinColor, borderRadius: '50%', zIndex: 2
              }}>
                {/* Eyes */}
                <div style={{ position: 'absolute', top: '35%', left: '28%', width: 4 * scale, height: 4 * scale, background: '#1a1a1a', borderRadius: '50%' }} />
                <div style={{ position: 'absolute', top: '35%', right: '28%', width: 4 * scale, height: 4 * scale, background: '#1a1a1a', borderRadius: '50%' }} />
                {/* Smile */}
                <div style={{ position: 'absolute', top: '58%', left: '50%', transform: 'translateX(-50%)', width: 10 * scale, height: 5 * scale, borderBottom: `2px solid #1a1a1a`, borderRadius: '0 0 50% 50%' }} />
              </div>
              
              {/* Hat/Head item */}
              {equipped.head && (
                <div style={{
                  position: 'absolute',
                  left: `${getPos('head').x}%`,
                  top: `${getPos('head').y}%`,
                  transform: 'translate(-50%, 0)',
                  zIndex: 10
                }}>
                  <ItemGraphic itemId={equipped.head} size={32 * scale} />
                </div>
              )}
              
              {/* Face item (glasses etc) - from accessory category */}
              {equipped.accessory && (
                <div style={{
                  position: 'absolute',
                  left: `${getPos('accessory').x}%`,
                  top: `${getPos('accessory').y}%`,
                  transform: 'translate(-50%, -50%)',
                  zIndex: 11
                }}>
                  <ItemGraphic itemId={equipped.accessory} size={28 * scale} />
                </div>
              )}
              
              {/* Neck item */}
              {equipped.neck && (
                <div style={{
                  position: 'absolute',
                  left: `${getPos('neck').x}%`,
                  top: `${getPos('neck').y}%`,
                  transform: 'translate(-50%, -50%)',
                  zIndex: 5
                }}>
                  <ItemGraphic itemId={equipped.neck} size={22 * scale} />
                </div>
              )}
              
              {/* Body/Shirt */}
              <div style={{
                position: 'absolute', top: 34 * scale, left: '50%', transform: 'translateX(-50%)',
                width: 32 * scale, height: 30 * scale, background: shirtColor,
                borderRadius: '4px 4px 0 0', zIndex: 1
              }}>
                {/* Arms */}
                <div style={{ position: 'absolute', top: 4 * scale, left: -8 * scale, width: 10 * scale, height: 22 * scale, background: shirtColor, borderRadius: 4 * scale }} />
                <div style={{ position: 'absolute', top: 4 * scale, right: -8 * scale, width: 10 * scale, height: 22 * scale, background: shirtColor, borderRadius: 4 * scale }} />
                {/* Hands */}
                <div style={{ position: 'absolute', top: 24 * scale, left: -10 * scale, width: 10 * scale, height: 10 * scale, background: skinColor, borderRadius: '50%' }} />
                <div style={{ position: 'absolute', top: 24 * scale, right: -10 * scale, width: 10 * scale, height: 10 * scale, background: skinColor, borderRadius: '50%' }} />
              </div>
              
              {/* Legs/Pants */}
              <div style={{
                position: 'absolute', top: 62 * scale, left: '50%', transform: 'translateX(-50%)',
                width: 28 * scale, height: 24 * scale, display: 'flex', gap: 4 * scale, zIndex: 1
              }}>
                <div style={{ flex: 1, background: pantsColor, borderRadius: '0 0 3px 3px' }} />
                <div style={{ flex: 1, background: pantsColor, borderRadius: '0 0 3px 3px' }} />
              </div>
              
              {/* Shoes */}
              <div style={{
                position: 'absolute', top: 84 * scale, left: '50%', transform: 'translateX(-50%)',
                width: 34 * scale, height: 10 * scale, display: 'flex', gap: 8 * scale, zIndex: 1
              }}>
                <div style={{ flex: 1, background: shoeColor, borderRadius: 4 * scale }} />
                <div style={{ flex: 1, background: shoeColor, borderRadius: 4 * scale }} />
              </div>
              
              {/* Weapon */}
              {equipped.weapon && (
                <div style={{
                  position: 'absolute',
                  left: `${getPos('weapon').x}%`,
                  top: `${getPos('weapon').y}%`,
                  transform: 'translate(-50%, -50%) rotate(-15deg)',
                  zIndex: 12
                }}>
                  <ItemGraphic itemId={equipped.weapon} size={38 * scale} />
                </div>
              )}
            </div>
          );
        };

        // ==================== ANIMATED PET ====================
        const AnimatedPet = ({ pet, containerWidth = 300, containerHeight = 200, startOffset = 0 }) => {
          const [pos, setPos] = useState({ x: 50 + startOffset, y: 50 + (startOffset % 30) });
          const [bubble, setBubble] = useState(null);
          const [direction, setDirection] = useState(1); // 1 = right, -1 = left
          const petData = SHOP_ITEMS.pets.find(p => p.id === pet);
          
          useEffect(() => {
            // Random movement
            const moveInterval = setInterval(() => {
              setPos(p => {
                const newX = Math.max(20, Math.min(containerWidth - 50, p.x + (Math.random() - 0.5) * 60));
                const newY = Math.max(20, Math.min(containerHeight - 50, p.y + (Math.random() - 0.5) * 40));
                setDirection(newX > p.x ? 1 : -1);
                return { x: newX, y: newY };
              });
            }, 2000 + Math.random() * 1000);
            
            // Random speech/thought bubbles
            const bubbleInterval = setInterval(() => {
              if (Math.random() > 0.5 && petData) {
                const isThought = Math.random() > 0.5;
                const arr = isThought ? petData.thoughts : petData.sounds;
                setBubble({ text: arr[Math.floor(Math.random() * arr.length)], type: isThought ? 'thought' : 'speech' });
                setTimeout(() => setBubble(null), 2500);
              }
            }, 3000 + Math.random() * 2000);
            
            return () => { clearInterval(moveInterval); clearInterval(bubbleInterval); };
          }, [containerWidth, containerHeight, petData]);
          
          if (!petData) return null;
          
          // Get pet emoji based on type
          const getPetEmoji = () => {
            const emojis = {
              dog: 'ðŸ•', cat: 'ðŸˆ', bunny: 'ðŸ°', dragon: 'ðŸ‰', unicorn: 'ðŸ¦„',
              phoenix: 'ðŸ”¥', owl: 'ðŸ¦‰', turtle: 'ðŸ¢'
            };
            return emojis[pet] || 'ðŸ¾';
          };
          
          return (
            <div style={{ 
              position: 'absolute', 
              left: pos.x, 
              top: pos.y, 
              transition: 'all 1.5s ease-in-out', 
              zIndex: 10,
              transform: `scaleX(${direction})`
            }}>
              {/* Pet body using emoji for simplicity but could be pixel art */}
              <div className="text-3xl animate-bounce" style={{ animationDuration: '1s' }}>
                {getPetEmoji()}
              </div>
              
              {/* Speech/Thought bubble */}
              {bubble && (
                <div style={{
                  position: 'absolute', 
                  bottom: '100%', 
                  left: '50%', 
                  transform: `translateX(-50%) scaleX(${direction})`, // Flip text back to normal
                  background: 'white', 
                  padding: '4px 8px', 
                  borderRadius: bubble.type === 'thought' ? '50%' : 8,
                  fontSize: 10, 
                  whiteSpace: 'nowrap', 
                  boxShadow: '0 2px 4px rgba(0,0,0,0.2)',
                  border: bubble.type === 'thought' ? '2px dotted #ccc' : '1px solid #ccc',
                  marginBottom: 4,
                  animation: 'fadeIn 0.3s ease-out'
                }}>
                  {bubble.type === 'thought' ? 'ðŸ’­ ' : 'ðŸ’¬ '}{bubble.text}
                </div>
              )}
            </div>
          );
        };

        // ==================== VISUAL HOUSE ====================
        const VisualHouse = ({ playerData, setPlayerData, onClose }) => {
          const [currentRoom, setCurrentRoom] = useState(null);
          const [charPos, setCharPos] = useState({ x: 150, y: 150 });
          const [draggingFurniture, setDraggingFurniture] = useState(null);
          const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });
          const houseRef = useRef(null);
          
          const rooms = [
            { id: 'living', name: 'Living Room', x: 35, y: 55, w: 30, h: 25 },
            ...(playerData.ownedItems?.rooms || []).map((id, i) => {
              const room = SHOP_ITEMS.rooms.find(r => r.id === id);
              return room ? { id: room.id, name: room.name, x: 10 + (i % 2) * 45, y: 25 + Math.floor(i / 2) * 30, w: 25, h: 20 } : null;
            }).filter(Boolean)
          ];
          
          const wallpaper = playerData.roomStyles?.[currentRoom]?.wallpaper;
          const floor = playerData.roomStyles?.[currentRoom]?.floor;
          const wallpaperData = SHOP_ITEMS.wallpapers.find(w => w.id === wallpaper);
          const floorData = SHOP_ITEMS.floors.find(f => f.id === floor);
          
          // All owned pets wander in the house
          const ownedPets = playerData.ownedItems?.pets || [];
          
          const handleRoomClick = (e) => {
            if (!houseRef.current || !currentRoom || draggingFurniture) return;
            const rect = houseRef.current.getBoundingClientRect();
            setCharPos({ x: e.clientX - rect.left, y: e.clientY - rect.top });
          };
          
          const handleFurnitureMouseDown = (e, furnitureKey) => {
            e.stopPropagation();
            const rect = houseRef.current.getBoundingClientRect();
            const furniture = (playerData.placedFurniture?.[currentRoom] || []).find(f => f.key === furnitureKey);
            if (furniture) {
              setDraggingFurniture(furnitureKey);
              setDragOffset({
                x: e.clientX - rect.left - furniture.x,
                y: e.clientY - rect.top - furniture.y
              });
            }
          };
          
          const handleMouseMove = (e) => {
            if (!draggingFurniture || !houseRef.current) return;
            const rect = houseRef.current.getBoundingClientRect();
            const newX = Math.max(30, Math.min(rect.width - 30, e.clientX - rect.left - dragOffset.x));
            const newY = Math.max(30, Math.min(rect.height - 50, e.clientY - rect.top - dragOffset.y));
            
            setPlayerData(p => ({
              ...p,
              placedFurniture: {
                ...p.placedFurniture,
                [currentRoom]: (p.placedFurniture?.[currentRoom] || []).map(f =>
                  f.key === draggingFurniture ? { ...f, x: newX, y: newY } : f
                )
              }
            }));
          };
          
          const handleMouseUp = () => {
            setDraggingFurniture(null);
          };
          
          const removeFurniture = (furnitureKey) => {
            setPlayerData(p => ({
              ...p,
              placedFurniture: {
                ...p.placedFurniture,
                [currentRoom]: (p.placedFurniture?.[currentRoom] || []).filter(f => f.key !== furnitureKey)
              }
            }));
          };
          
          const getFurnitureEmoji = (id) => {
            const emojis = {
              turtle_fountain: 'ðŸ¢â›²', bed: 'ðŸ›ï¸', couch: 'ðŸ›‹ï¸', chair: 'ðŸª‘', tv: 'ðŸ“º',
              computer: 'ðŸ–¥ï¸', bookshelf: 'ðŸ“š', piano: 'ðŸŽ¹', aquarium: 'ðŸ ', fireplace: 'ðŸ”¥',
              trophy: 'ðŸ†', plant: 'ðŸª´', lamp: 'ðŸª”'
            };
            return emojis[id] || 'ðŸ“¦';
          };
          
          // House exterior view
          if (!currentRoom) {
            return (
              <div className="fixed inset-0 bg-gradient-to-b from-sky-400 to-sky-200 flex flex-col z-50">
                <div className="bg-slate-800 p-2 flex justify-between items-center">
                  <h2 className="text-lg font-bold text-white">ðŸ  My House</h2>
                  <div className="flex gap-2 items-center">
                    <span className="text-green-400 font-bold text-sm">{formatMoney(playerData.coins)}</span>
                    <button onClick={onClose} className="text-xl">âŒ</button>
                  </div>
                </div>
                
                <div className="flex-1 flex items-center justify-center p-4">
                  <div className="relative">
                    {/* House */}
                    <div style={{ width: 280, height: 220 }}>
                      {/* Roof */}
                      <div style={{
                        width: 0, height: 0,
                        borderLeft: '150px solid transparent',
                        borderRight: '150px solid transparent',
                        borderBottom: '80px solid #3498db',
                        margin: '0 auto'
                      }} />
                      {/* Main building */}
                      <div style={{
                        width: 260, height: 140, background: '#ecf0f1',
                        margin: '0 auto', position: 'relative',
                        boxShadow: 'inset 0 0 20px rgba(0,0,0,0.1)'
                      }}>
                        {/* Door */}
                        <div style={{
                          position: 'absolute', bottom: 0, left: '50%', transform: 'translateX(-50%)',
                          width: 50, height: 80, background: '#8B4513', borderRadius: '5px 5px 0 0'
                        }}>
                          <div style={{ position: 'absolute', right: 8, top: '50%', width: 8, height: 8, background: '#f1c40f', borderRadius: '50%' }} />
                        </div>
                        {/* Windows */}
                        <div style={{ position: 'absolute', top: 20, left: 30, width: 50, height: 50, background: '#87CEEB', border: '4px solid #8B4513' }}>
                          <div style={{ position: 'absolute', left: '50%', top: 0, bottom: 0, width: 2, background: '#8B4513' }} />
                          <div style={{ position: 'absolute', top: '50%', left: 0, right: 0, height: 2, background: '#8B4513' }} />
                        </div>
                        <div style={{ position: 'absolute', top: 20, right: 30, width: 50, height: 50, background: '#87CEEB', border: '4px solid #8B4513' }}>
                          <div style={{ position: 'absolute', left: '50%', top: 0, bottom: 0, width: 2, background: '#8B4513' }} />
                          <div style={{ position: 'absolute', top: '50%', left: 0, right: 0, height: 2, background: '#8B4513' }} />
                        </div>
                      </div>
                    </div>
                    
                    {/* Room buttons */}
                    <div className="mt-4 grid grid-cols-2 gap-2">
                      {rooms.map(room => (
                        <button key={room.id} onClick={() => setCurrentRoom(room.id)}
                          className="px-4 py-3 bg-amber-600 hover:bg-amber-500 text-white font-bold rounded-lg shadow-lg transition">
                          {room.name}
                        </button>
                      ))}
                    </div>
                    
                    {/* Show owned pets count */}
                    {ownedPets.length > 0 && (
                      <div className="mt-3 text-center text-white bg-slate-800/80 rounded-lg p-2">
                        ðŸ¾ {ownedPets.length} pet{ownedPets.length > 1 ? 's' : ''} living here!
                      </div>
                    )}
                  </div>
                </div>
                
                {/* Ground */}
                <div style={{ height: 60, background: 'linear-gradient(to bottom, #2ecc71, #27ae60)' }} />
              </div>
            );
          }
          
          // Room interior view
          const roomFurniture = (playerData.placedFurniture || {})[currentRoom] || [];
          
          return (
            <div className="fixed inset-0 bg-slate-900 flex flex-col z-50">
              <div className="bg-slate-800 p-2 flex justify-between items-center">
                <div className="flex gap-2 items-center">
                  <button onClick={() => setCurrentRoom(null)} className="text-white text-sm">â† House</button>
                  <h2 className="text-lg font-bold text-white">{rooms.find(r => r.id === currentRoom)?.name}</h2>
                </div>
                <button onClick={onClose} className="text-xl">âŒ</button>
              </div>
              
              <div 
                ref={houseRef} 
                onClick={handleRoomClick} 
                onMouseMove={handleMouseMove}
                onMouseUp={handleMouseUp}
                onMouseLeave={handleMouseUp}
                className="flex-1 relative cursor-pointer overflow-hidden"
                style={{ background: wallpaperData?.color || '#f5f5dc' }}
              >
                {/* Floor */}
                <div className="absolute bottom-0 left-0 right-0 h-16" style={{ background: floorData?.color || '#8B4513' }} />
                
                {/* Furniture items - DRAGGABLE */}
                {roomFurniture.map(f => {
                  const item = SHOP_ITEMS.furniture.find(i => i.id === f.id);
                  const isDragging = draggingFurniture === f.key;
                  return item && (
                    <div 
                      key={f.key} 
                      style={{ 
                        position: 'absolute', 
                        left: f.x, 
                        top: f.y, 
                        transform: 'translate(-50%, -50%)',
                        cursor: isDragging ? 'grabbing' : 'grab',
                        zIndex: isDragging ? 100 : 10,
                        transition: isDragging ? 'none' : 'box-shadow 0.2s'
                      }}
                      className={`text-4xl select-none group ${isDragging ? 'scale-110' : 'hover:scale-105'}`}
                      onMouseDown={(e) => handleFurnitureMouseDown(e, f.key)}
                    >
                      {getFurnitureEmoji(item.id)}
                      {/* Delete button */}
                      <button
                        onClick={(e) => { e.stopPropagation(); removeFurniture(f.key); }}
                        className="absolute -top-2 -right-2 w-5 h-5 bg-red-500 rounded-full text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"
                      >
                        Ã—
                      </button>
                      {/* Drag hint */}
                      {isDragging && (
                        <div className="absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs text-white bg-black/70 px-2 py-0.5 rounded whitespace-nowrap">
                          Drag to move
                        </div>
                      )}
                    </div>
                  );
                })}
                
                {/* ALL OWNED PETS wander around */}
                {ownedPets.map((petId, index) => (
                  <AnimatedPet 
                    key={petId} 
                    pet={petId} 
                    containerWidth={350} 
                    containerHeight={250}
                    startOffset={index * 50}
                  />
                ))}
                
                {/* Character */}
                <div style={{ position: 'absolute', left: charPos.x, top: charPos.y, transform: 'translate(-50%, -50%)', transition: 'all 0.3s', zIndex: 20 }}>
                  <PixelCharacter equipped={playerData.equippedItems} size={70} />
                </div>
                
                {/* Instructions overlay */}
                <div className="absolute top-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded">
                  ðŸ–±ï¸ Click floor to walk â€¢ Drag furniture to move
                </div>
              </div>
              
              {/* Furniture placement panel */}
              <div className="bg-slate-800 p-2">
                <div className="text-white text-xs mb-1">Add furniture from your inventory:</div>
                <div className="flex gap-1 overflow-x-auto pb-1">
                  {(playerData.ownedItems?.furniture || []).map(fId => {
                    const item = SHOP_ITEMS.furniture.find(f => f.id === fId);
                    return item && (
                      <button key={fId + '-btn'} onClick={() => {
                        setPlayerData(p => ({
                          ...p,
                          placedFurniture: {
                            ...p.placedFurniture,
                            [currentRoom]: [...(p.placedFurniture?.[currentRoom] || []), { id: fId, x: 150, y: 120, key: Date.now() }]
                          }
                        }));
                      }} className="p-2 bg-slate-700 rounded text-xl hover:bg-slate-600 flex-shrink-0" title={item.name}>
                        {getFurnitureEmoji(item.id)}
                      </button>
                    );
                  })}
                  {(playerData.ownedItems?.furniture || []).length === 0 && (
                    <span className="text-slate-400 text-sm py-2">No furniture yet - buy some in the shop!</span>
                  )}
                </div>
              </div>
            </div>
          );
        };

        // ==================== DRESSING ROOM ====================
        const DressingRoom = ({ playerData, setPlayerData, onClose }) => {
          const [selectedType, setSelectedType] = useState('hair');
          const [draggingItem, setDraggingItem] = useState(null);
          const [dragPos, setDragPos] = useState({ x: 0, y: 0 });
          const characterRef = useRef(null);
          
          const types = ['hair', 'face', 'head', 'accessory', 'neck', 'shirt', 'pants', 'shoes', 'back', 'weapon'];
          const typeLabels = { hair: 'ðŸ’‡ Hair', face: 'ðŸ‘ï¸ Face', head: 'ðŸŽ© Hats', accessory: 'ðŸ‘“ Glasses', neck: 'ðŸ“¿ Neck', shirt: 'ðŸ‘• Shirts', pants: 'ðŸ‘– Pants', shoes: 'ðŸ‘Ÿ Shoes', back: 'ðŸ¦¸ Back', weapon: 'âš”ï¸ Weapons' };
          
          // Get all items for the selected type (owned + free)
          const getItemsForType = (type) => {
            // Get all free items of this type from SHOP_ITEMS
            const freeItems = SHOP_ITEMS.outfits.filter(i => i.free && i.type === type);
            
            if (type === 'weapon') {
              const ownedWeapons = (playerData.ownedItems?.weapons || [])
                .map(id => SHOP_ITEMS.weapons.find(i => i.id === id))
                .filter(Boolean);
              return ownedWeapons;
            }
            
            if (type === 'accessory') {
              // Accessories like glasses, sunglasses, monocle
              const ownedAccessories = (playerData.ownedItems?.outfits || [])
                .map(id => SHOP_ITEMS.outfits.find(i => i.id === id))
                .filter(i => i && i.type === 'accessory');
              return ownedAccessories;
            }
            
            // Owned paid items of this type (not free ones)
            const ownedItems = (playerData.ownedItems?.outfits || [])
              .map(id => SHOP_ITEMS.outfits.find(i => i.id === id))
              .filter(i => i && i.type === type && !i.free);
            
            return [...freeItems, ...ownedItems];
          };
          
          const items = getItemsForType(selectedType);
          
          const handleDragStart = (e, item) => {
            setDraggingItem(item);
          };
          
          const handleDrag = (e) => {
            if (draggingItem && e.clientX && e.clientY) {
              setDragPos({ x: e.clientX, y: e.clientY });
            }
          };
          
          const handleDragEnd = (e) => {
            if (!draggingItem || !characterRef.current) {
              setDraggingItem(null);
              return;
            }
            
            const rect = characterRef.current.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Check if dropped on character
            if (x >= 0 && x <= rect.width && y >= 0 && y <= rect.height) {
              // Calculate percentage position
              const posX = Math.round((x / rect.width) * 100);
              const posY = Math.round((y / rect.height) * 100);
              
              // Equip the item and save its position
              const equipKey = selectedType === 'weapon' ? 'weapon' : selectedType;
              setPlayerData(p => ({
                ...p,
                equippedItems: { ...p.equippedItems, [equipKey]: draggingItem.id },
                itemPositions: { ...(p.itemPositions || {}), [equipKey]: { x: posX, y: posY } }
              }));
            }
            
            setDraggingItem(null);
          };
          
          const equipItem = (item) => {
            const key = selectedType === 'weapon' ? 'weapon' : selectedType;
            const isEquipped = playerData.equippedItems?.[key] === item.id;
            
            setPlayerData(p => ({
              ...p,
              equippedItems: { ...p.equippedItems, [key]: isEquipped ? null : item.id }
            }));
          };
          
          const resetPosition = (type) => {
            setPlayerData(p => ({
              ...p,
              itemPositions: { ...(p.itemPositions || {}), [type]: undefined }
            }));
          };
          
          return (
            <div 
              className="fixed inset-0 bg-gradient-to-b from-purple-900 to-slate-900 flex flex-col z-50"
              onDragOver={(e) => e.preventDefault()}
              onMouseMove={handleDrag}
              onMouseUp={handleDragEnd}
            >
              <div className="bg-slate-800 p-3 flex justify-between items-center">
                <h2 className="text-xl font-bold text-white">ðŸ‘” Dressing Room</h2>
                <button onClick={onClose} className="text-2xl hover:scale-110 transition">âŒ</button>
              </div>
              
              <div className="flex-1 flex gap-4 p-4 overflow-hidden">
                {/* Character preview area */}
                <div className="flex-1 flex flex-col items-center justify-center bg-slate-800/50 rounded-2xl p-4 relative">
                  <div className="text-white text-sm mb-2 text-center">
                    Drag items onto your character to position them!
                  </div>
                  <div 
                    ref={characterRef}
                    className="relative bg-slate-700/50 rounded-xl p-4"
                    style={{ width: 240, height: 280 }}
                  >
                    <PixelCharacter 
                      equipped={playerData.equippedItems} 
                      itemPositions={playerData.itemPositions || {}}
                      size={220} 
                      style={{ margin: '0 auto' }}
                    />
                  </div>
                  
                  {/* Reset positions button */}
                  <button 
                    onClick={() => setPlayerData(p => ({ ...p, itemPositions: {} }))}
                    className="mt-3 px-4 py-1 bg-slate-600 hover:bg-slate-500 text-white text-sm rounded-lg"
                  >
                    Reset All Positions
                  </button>
                </div>
                
                {/* Item selection panel */}
                <div className="w-72 flex flex-col bg-slate-800/50 rounded-2xl overflow-hidden">
                  {/* Category tabs */}
                  <div className="p-2 bg-slate-800">
                    <div className="grid grid-cols-5 gap-1">
                      {types.map(t => (
                        <button 
                          key={t} 
                          onClick={() => setSelectedType(t)}
                          className={`px-1 py-2 rounded text-xs font-bold transition ${
                            selectedType === t 
                              ? 'bg-yellow-500 text-black' 
                              : 'bg-slate-700 text-white hover:bg-slate-600'
                          }`}
                          title={typeLabels[t]}
                        >
                          {typeLabels[t].split(' ')[0]}
                        </button>
                      ))}
                    </div>
                  </div>
                  
                  <div className="p-2 bg-slate-700/50 text-center">
                    <span className="text-yellow-400 font-bold">{typeLabels[selectedType]}</span>
                  </div>
                  
                  {/* Items grid */}
                  <div className="flex-1 overflow-y-auto p-3">
                    <div className="grid grid-cols-3 gap-2">
                      {items.map(item => {
                        const isEquipped = playerData.equippedItems?.[selectedType === 'weapon' ? 'weapon' : selectedType] === item.id;
                        const isFree = item.price === 0;
                        
                        return (
                          <div
                            key={item.id}
                            draggable
                            onDragStart={(e) => handleDragStart(e, item)}
                            onMouseDown={(e) => handleDragStart(e, item)}
                            onClick={() => equipItem(item)}
                            className={`p-2 rounded-lg cursor-grab active:cursor-grabbing transition-all ${
                              isEquipped 
                                ? 'bg-green-600 ring-2 ring-green-400' 
                                : 'bg-slate-700 hover:bg-slate-600 hover:scale-105'
                            } ${isFree ? 'border border-dashed border-green-500' : ''}`}
                          >
                            <div className="flex justify-center mb-1">
                              <ItemGraphic itemId={item.id} size={40} />
                            </div>
                            <div className="text-white text-xs text-center truncate">{item.name}</div>
                            {isFree && <div className="text-green-400 text-xs text-center">FREE</div>}
                          </div>
                        );
                      })}
                      {items.length === 0 && (
                        <div className="col-span-3 text-slate-400 text-center py-8 text-sm">
                          No {selectedType} items available.<br/>
                          Visit the shop to buy some!
                        </div>
                      )}
                    </div>
                  </div>
                  
                  {/* Instructions */}
                  <div className="p-3 bg-slate-800 text-slate-400 text-xs text-center">
                    ðŸ’¡ Click to equip/unequip â€¢ Drag onto character to position
                  </div>
                </div>
              </div>
              
              {/* Dragging indicator */}
              {draggingItem && dragPos.x > 0 && (
                <div 
                  className="fixed pointer-events-none z-50"
                  style={{ left: dragPos.x - 25, top: dragPos.y - 25 }}
                >
                  <ItemGraphic itemId={draggingItem.id} size={50} />
                </div>
              )}
            </div>
          );
        };

        // ==================== CASINO ====================
        const Casino = ({ playerData, setPlayerData, onClose, questions }) => {
          const [betAmount, setBetAmount] = useState(1000);
          const [gameState, setGameState] = useState('betting'); // betting, playing, won, lost
          const [currentQ, setCurrentQ] = useState(0);
          const [question, setQuestion] = useState(null);
          const [selected, setSelected] = useState(null);
          const [revealed, setRevealed] = useState(false);
          const casinoUsedRef = useRef(new Set());
          
          const startGame = () => {
            if (betAmount > playerData.coins || betAmount <= 0) return;
            setPlayerData(p => ({ ...p, coins: p.coins - betAmount }));
            setGameState('playing');
            setCurrentQ(0);
            casinoUsedRef.current = new Set(); // Reset for new casino game
            loadQuestion();
          };
          
          const loadQuestion = () => {
            const cats = ['math', 'science', 'trivia', 'soccer', 'english', 'flags'];
            const cat = cats[Math.floor(Math.random() * cats.length)];
            const diffs = ['easy', 'medium', 'hard'];
            const diff = diffs[Math.floor(Math.random() * diffs.length)];
            const bank = questions[cat]?.[diff] || questions.trivia?.easy;
            
            if (!bank || bank.length === 0) {
              setQuestion({ q: 'No questions', o: ['A', 'B', 'C', 'D'], a: 0, category: cat });
              return;
            }
            
            // Get question key
            const getQKey = (q) => `casino-${q.q}`;
            
            // Filter to questions not used this casino session
            let available = bank.filter(q => !casinoUsedRef.current.has(getQKey(q)));
            
            // If all used, reset and use all
            if (available.length === 0) {
              casinoUsedRef.current = new Set();
              available = bank;
            }
            
            const q = available[Math.floor(Math.random() * available.length)];
            
            // Mark as used IMMEDIATELY
            casinoUsedRef.current.add(getQKey(q));
            
            setQuestion({ ...q, category: CATEGORIES.find(c => c.id === cat)?.name || cat });
            setSelected(null);
            setRevealed(false);
          };
          
          const answer = (idx) => {
            if (revealed) return;
            setSelected(idx);
            setRevealed(true);
            
            setTimeout(() => {
              if (idx === question.a) {
                if (currentQ >= 4) {
                  setPlayerData(p => ({ ...p, coins: p.coins + betAmount * 2 }));
                  setGameState('won');
                } else {
                  setCurrentQ(c => c + 1);
                  loadQuestion();
                }
              } else {
                setGameState('lost');
              }
            }, 1000);
          };
          
          return (
            <div className="fixed inset-0 bg-gradient-to-b from-purple-900 to-black flex flex-col z-50 p-4">
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-2xl font-bold text-yellow-400">ðŸŽ° CASINO</h2>
                <button onClick={onClose} className="text-2xl">âŒ</button>
              </div>
              
              {gameState === 'betting' && (
                <div className="flex-1 flex flex-col items-center justify-center">
                  <div className="text-white text-lg mb-2">Your balance: {formatMoney(playerData.coins)}</div>
                  <div className="text-yellow-400 text-2xl font-bold mb-4">Place Your Bet!</div>
                  <input type="number" value={betAmount} onChange={e => setBetAmount(Math.max(1, parseInt(e.target.value) || 0))}
                    className="w-48 p-3 text-2xl text-center rounded-lg mb-4" />
                  <div className="flex gap-2 mb-4">
                    {[1000, 10000, 100000, 1000000].map(amt => (
                      <button key={amt} onClick={() => setBetAmount(amt)}
                        className="px-3 py-1 bg-yellow-600 hover:bg-yellow-500 text-white rounded font-bold text-sm">
                        {formatMoney(amt)}
                      </button>
                    ))}
                  </div>
                  <div className="text-slate-300 mb-4 text-center">
                    Answer 5 questions correctly to win <span className="text-green-400 font-bold">{formatMoney(betAmount * 2)}</span>!
                    <br /><span className="text-xs">(Random categories, excluding KOTLC)</span>
                  </div>
                  <button onClick={startGame} disabled={betAmount > playerData.coins}
                    className={`px-8 py-3 rounded-xl font-bold text-xl ${betAmount <= playerData.coins ? 'bg-green-500 hover:bg-green-400' : 'bg-gray-500'} text-white`}>
                    PLAY
                  </button>
                </div>
              )}
              
              {gameState === 'playing' && question && (
                <div className="flex-1 flex flex-col items-center justify-center">
                  <div className="text-yellow-400 font-bold mb-2">Question {currentQ + 1} of 5</div>
                  <div className="w-full max-w-md bg-slate-800 rounded-xl p-4 mb-4">
                    <div className="text-xs text-blue-400 mb-2">{question.category}</div>
                    <div className="text-white text-lg font-semibold">{question.q}</div>
                  </div>
                  <div className="grid grid-cols-2 gap-2 w-full max-w-md">
                    {question.o.map((opt, i) => (
                      <button key={i} onClick={() => answer(i)}
                        className={`p-3 rounded-lg font-bold text-left ${
                          revealed ? (i === question.a ? 'bg-green-500' : i === selected ? 'bg-red-500' : 'bg-slate-700') :
                          i === selected ? 'bg-orange-500' : 'bg-slate-700 hover:bg-blue-600'
                        } text-white`}>
                        {opt}
                      </button>
                    ))}
                  </div>
                </div>
              )}
              
              {(gameState === 'won' || gameState === 'lost') && (
                <div className="flex-1 flex flex-col items-center justify-center">
                  {gameState === 'won' ? (
                    <>
                      <div className="text-8xl mb-4 animate-bounce">ðŸŽ‰</div>
                      <div className="text-4xl font-black text-yellow-400 mb-2">JACKPOT!</div>
                      <div className="text-2xl text-white mb-2">You answered all 5 correctly!</div>
                      <div className="bg-green-600 rounded-xl p-6 mb-6 text-center">
                        <div className="text-white text-lg mb-1">Your bet:</div>
                        <div className="text-yellow-300 text-2xl font-bold mb-3">{formatMoney(betAmount)}</div>
                        <div className="text-white text-lg mb-1">You won:</div>
                        <div className="text-green-300 text-4xl font-black">{formatMoney(betAmount * 2)}</div>
                        <div className="text-green-200 text-sm mt-2">(Double your bet!)</div>
                      </div>
                      <div className="text-white text-lg mb-4">
                        New balance: <span className="text-green-400 font-bold">{formatMoney(playerData.coins)}</span>
                      </div>
                      <button onClick={() => setGameState('betting')} className="px-8 py-3 bg-yellow-500 hover:bg-yellow-400 text-black rounded-xl font-black text-xl">
                        OK âœ“
                      </button>
                    </>
                  ) : (
                    <>
                      <div className="text-6xl mb-4">ðŸ˜¢</div>
                      <div className="text-3xl font-bold mb-4 text-red-400">YOU LOST!</div>
                      <div className="bg-red-900/50 rounded-xl p-4 mb-4 text-center">
                        <div className="text-white">You lost your bet of</div>
                        <div className="text-red-400 text-2xl font-bold">{formatMoney(betAmount)}</div>
                      </div>
                      <div className="text-white mb-4">
                        Balance: <span className="text-green-400 font-bold">{formatMoney(playerData.coins)}</span>
                      </div>
                      <button onClick={() => setGameState('betting')} className="px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-bold">
                        Try Again
                      </button>
                    </>
                  )}
                </div>
              )}
            </div>
          );
        };

        // ==================== SHOP ====================
        const Shop = ({ playerData, onBuy, onClose }) => {
          const [tab, setTab] = useState('outfits');
          const tabs = ['outfits', 'weapons', 'pets', 'furniture', 'rooms', 'wallpapers', 'floors'];
          const tabIcons = { outfits: 'ðŸ‘•', weapons: 'âš”ï¸', pets: 'ðŸ¾', furniture: 'ðŸª‘', rooms: 'ðŸ ', wallpapers: 'ðŸŽ¨', floors: 'ðŸŸ«' };
          
          // Get pet emoji
          const getPetEmoji = (id) => {
            const emojis = { dog: 'ðŸ•', cat: 'ðŸˆ', bunny: 'ðŸ°', dragon: 'ðŸ‰', unicorn: 'ðŸ¦„', phoenix: 'ðŸ”¥', owl: 'ðŸ¦‰', turtle: 'ðŸ¢' };
            return emojis[id] || 'ðŸ¾';
          };
          
          // Get furniture emoji
          const getFurnEmoji = (id) => {
            const emojis = { turtle_fountain: 'ðŸ¢â›²', bed: 'ðŸ›ï¸', couch: 'ðŸ›‹ï¸', chair: 'ðŸª‘', tv: 'ðŸ“º', computer: 'ðŸ–¥ï¸', bookshelf: 'ðŸ“š', piano: 'ðŸŽ¹', aquarium: 'ðŸ ', fireplace: 'ðŸ”¥', trophy: 'ðŸ†', plant: 'ðŸª´', lamp: 'ðŸª”' };
            return emojis[id] || 'ðŸ“¦';
          };
          
          // Get room emoji
          const getRoomEmoji = (id) => {
            const emojis = { bedroom: 'ðŸ›ï¸', gaming: 'ðŸŽ®', kitchen: 'ðŸ³', library: 'ðŸ“š', garden: 'ðŸŒ³', pool: 'ðŸŠ' };
            return emojis[id] || 'ðŸšª';
          };
          
          return (
            <div className="fixed inset-0 bg-gradient-to-b from-slate-900 to-purple-900 flex flex-col z-50 p-2">
              <div className="flex justify-between items-center mb-2 bg-slate-800 p-2 rounded-lg">
                <h2 className="text-xl font-bold text-yellow-400">ðŸ›’ SHOP</h2>
                <div className="flex gap-2 items-center">
                  <span className="text-green-400 font-bold">{formatMoney(playerData.coins)}</span>
                  <button onClick={onClose} className="text-xl hover:scale-110 transition">âŒ</button>
                </div>
              </div>
              
              <div className="flex gap-1 mb-2 overflow-x-auto pb-1">
                {tabs.map(t => (
                  <button key={t} onClick={() => setTab(t)}
                    className={`px-3 py-2 rounded-lg font-bold text-sm whitespace-nowrap transition ${tab === t ? 'bg-yellow-500 text-black' : 'bg-slate-700 text-white hover:bg-slate-600'}`}>
                    {tabIcons[t]} {t.charAt(0).toUpperCase() + t.slice(1)}
                  </button>
                ))}
              </div>
              
              <div className="flex-1 overflow-y-auto">
                <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2">
                  {(SHOP_ITEMS[tab] || []).filter(item => !item.free).map(item => {
                    const owned = playerData.ownedItems?.[tab]?.includes(item.id);
                    const canAfford = playerData.coins >= item.price;
                    
                    return (
                      <div key={item.id} className={`p-3 rounded-xl border-2 transition-all hover:scale-102 ${owned ? 'border-green-500 bg-green-900/30' : 'border-slate-600 bg-slate-800/80'}`}>
                        {/* Item display based on type */}
                        <div className="flex justify-center mb-2">
                          {tab === 'outfits' || tab === 'weapons' ? (
                            <ItemGraphic itemId={item.id} size={50} />
                          ) : tab === 'pets' ? (
                            <div className="text-4xl">{getPetEmoji(item.id)}</div>
                          ) : tab === 'furniture' ? (
                            <div className="text-4xl">{getFurnEmoji(item.id)}</div>
                          ) : tab === 'rooms' ? (
                            <div className="text-4xl">{getRoomEmoji(item.id)}</div>
                          ) : tab === 'wallpapers' || tab === 'floors' ? (
                            <div className="w-12 h-12 rounded-lg border-2 border-slate-500" style={{ background: item.color }} />
                          ) : (
                            <div className="text-3xl">ðŸ“¦</div>
                          )}
                        </div>
                        <div className="text-white text-center font-bold text-xs">{item.name}</div>
                        <div className="text-yellow-400 text-center text-xs mb-1">{formatMoney(item.price)}</div>
                        {owned ? (
                          <div className="text-green-400 text-center text-xs py-1">âœ“ Owned</div>
                        ) : (
                          <button onClick={() => canAfford && onBuy(tab, item)} disabled={!canAfford}
                            className={`w-full py-1.5 rounded-lg text-xs font-bold transition ${canAfford ? 'bg-yellow-500 hover:bg-yellow-400 text-black' : 'bg-slate-600 text-slate-400 cursor-not-allowed'}`}>
                            {canAfford ? 'BUY' : 'ðŸ’° Need more'}
                          </button>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          );
        };

        // ==================== MAIN COMPONENT ====================
        function MillionaireQuiz() {
          const loadData = () => {
            try {
              const s = localStorage.getItem('millionaireV4');
              if (s) {
                const saved = JSON.parse(s);
                if (!saved.itemPositions) saved.itemPositions = {};
                return saved;
              }
            } catch {}
            return {
              coins: 0,
              ownedItems: { outfits: [], weapons: [], pets: [], furniture: [], rooms: [], wallpapers: [], floors: [] },
              equippedItems: {},
              itemPositions: {},
              placedFurniture: {},
              roomStyles: {},
              gamesPlayed: 0
            };
          };

          const [data, setData] = useState(loadData);
          const [screen, setScreen] = useState('menu');
          const [showShop, setShowShop] = useState(false);
          const [showHouse, setShowHouse] = useState(false);
          const [showDressing, setShowDressing] = useState(false);
          const [showCasino, setShowCasino] = useState(false);
          const [showCats, setShowCats] = useState(false);
          const [category, setCategory] = useState(null);
          const [level, setLevel] = useState(0);
          const [safeLevel, setSafeLevel] = useState(-1);
          const [question, setQuestion] = useState(null);
          const [selected, setSelected] = useState(null);
          const [revealed, setRevealed] = useState(false);
          const [stats, setStats] = useState({ correct: 0, wrong: 0, streak: 0 });
          const [msg, setMsg] = useState('');
          const [earned, setEarned] = useState(0);
          
          // Array to track used question texts this session
          const [usedQuestions, setUsedQuestions] = useState([]);
          
          // Questions are now loaded from the embedded constant
          const [questions, setQuestions] = useState(EMBEDDED_QUESTIONS);
          
          // Calculate total questions count
          const questionCount = Object.values(questions).reduce((acc, cat) => {
            return acc + Object.values(cat).reduce((a, diff) => a + diff.length, 0);
          }, 0);

          useEffect(() => { localStorage.setItem('millionaireV4', JSON.stringify(data)); }, [data]);

          // ================= FIX: Pick Question Logic with Reset =================
          const pickQuestion = (currentLevel, currentCategory, currentUsed) => {
            const diff = currentLevel < 5 ? 'easy' : currentLevel < 10 ? 'medium' : 'hard';
            
            let cat;
            if (currentCategory === 'kotlc') {
              cat = 'kotlc';
            } else {
              const nonKotlcCats = ['math', 'science', 'trivia', 'soccer', 'english', 'flags'];
              cat = Math.random() < 0.5 ? currentCategory : nonKotlcCats[Math.floor(Math.random() * nonKotlcCats.length)];
            }
            
            // Safe access to the question bank
            const bank = questions[cat]?.[diff] || questions.trivia?.[diff];
            
            if (!bank || bank.length === 0) {
              return { 
                q: { question: 'No questions available', options: ['A', 'B', 'C', 'D'], correct: 0, category: cat }, 
                newUsed: currentUsed 
              };
            }
            
            // Filter out used questions by their text
            let available = bank.filter(q => !currentUsed.includes(q.q));
            let resetUsed = false;
            
            // FIX: If all questions used, CLEAR the used list for the next cycle
            // instead of just picking random and keeping the list full.
            if (available.length === 0) {
              available = bank;
              resetUsed = true; // We will reset the tracking
            }
            
            // Pick random
            const picked = available[Math.floor(Math.random() * available.length)];
            
            // If we reset, start a fresh array. Otherwise append.
            const newUsed = resetUsed ? [picked.q] : [...currentUsed, picked.q];
            
            return {
              q: { 
                ...picked, 
                question: picked.q, 
                options: picked.o, 
                correct: picked.a, 
                category: CATEGORIES.find(c => c.id === cat)?.name || cat, 
                big: picked.big 
              },
              newUsed
            };
          };

          const start = (cat) => {
            setCategory(cat);
            setScreen('play');
            setLevel(0);
            setSafeLevel(-1);
            setStats({ correct: 0, wrong: 0, streak: 0 });
            setUsedQuestions([]); // Reset used questions for new game
            setMsg('');
            setEarned(0);
            setShowCats(false);
            
            // Pick first question immediately with empty used list
            const result = pickQuestion(0, cat, []);
            setQuestion(result.q);
            setUsedQuestions(result.newUsed);
            setSelected(null);
            setRevealed(false);
          };

          const confirm = () => {
            if (selected === null) return;
            setRevealed(true);
            const ok = selected === question.correct;

            setTimeout(() => {
              if (ok) {
                const nxt = level + 1;
                setStats(p => ({ ...p, correct: p.correct + 1, streak: 0 }));
                if (PRIZE_LADDER[level]?.safe) {
                  setSafeLevel(level);
                  setMsg(`ðŸŒŸ Safe! ${formatMoney(PRIZE_LADDER[level].amount)} locked!`);
                } else {
                  setMsg('âœ… Correct!');
                }
                if (nxt >= 15) {
                  setEarned(1000000);
                  setData(p => ({ ...p, coins: p.coins + 1000000, gamesPlayed: p.gamesPlayed + 1 }));
                  setScreen('won');
                } else {
                  setLevel(nxt);
                  setTimeout(() => { 
                    setMsg(''); 
                    // Use functional update to get latest usedQuestions
                    setUsedQuestions(currentUsed => {
                      const result = pickQuestion(nxt, category, currentUsed);
                      setQuestion(result.q);
                      return result.newUsed;
                    });
                    setSelected(null);
                    setRevealed(false);
                  }, 1000);
                }
              } else {
                const ns = stats.streak + 1;
                setStats(p => ({ ...p, wrong: p.wrong + 1, streak: ns }));
                if (ns >= 3 || (safeLevel < 0 && level < 5)) {
                  const amt = safeLevel >= 0 ? PRIZE_LADDER[safeLevel].amount : 0;
                  setEarned(amt);
                  setData(p => ({ ...p, coins: p.coins + amt, gamesPlayed: p.gamesPlayed + 1 }));
                  setMsg(ns >= 3 ? 'ðŸ’€ 3 Wrong!' : 'ðŸ’€ Game Over!');
                  setTimeout(() => setScreen('lost'), 1500);
                } else {
                  setMsg('âŒ Wrong!');
                  const resetLevel = Math.max(0, safeLevel >= 0 ? safeLevel : 0);
                  setLevel(resetLevel);
                  setTimeout(() => { 
                    setMsg(''); 
                    setUsedQuestions(currentUsed => {
                      const result = pickQuestion(resetLevel, category, currentUsed);
                      setQuestion(result.q);
                      return result.newUsed;
                    });
                    setSelected(null);
                    setRevealed(false);
                  }, 1500);
                }
              }
            }, 1000);
          };

          const buy = (cat, item) => {
            if (data.coins >= item.price && !data.ownedItems?.[cat]?.includes(item.id)) {
              setData(p => ({
                ...p,
                coins: p.coins - item.price,
                ownedItems: { ...p.ownedItems, [cat]: [...(p.ownedItems?.[cat] || []), item.id] }
              }));
            }
          };

          // MENU
          if (screen === 'menu') {
            return (
              <div className="min-h-screen bg-gradient-to-b from-slate-900 via-purple-900 to-slate-900 flex flex-col items-center justify-center p-4">
                <h1 className="text-4xl font-black text-yellow-400 mb-1" style={{ textShadow: '3px 3px #000' }}>MILLIONAIRE</h1>
                <div className="text-white font-bold mb-4">ARENA</div>
                
                {/* Questions Status - Always Ready now */}
                <div className="text-green-400 text-sm mb-2">âœ“ {questionCount} questions ready</div>
                
                {/* Character Preview */}
                <div className="bg-slate-800/80 rounded-xl p-4 mb-4 w-full max-w-xs">
                  <div className="flex justify-between items-center">
                    <div>
                      <div className="text-green-400 font-bold text-lg">{formatMoney(data.coins)}</div>
                      <div className="text-slate-400 text-xs">Games: {data.gamesPlayed}</div>
                    </div>
                    <div onClick={() => setShowDressing(true)} className="cursor-pointer hover:scale-110 transition">
                      <PixelCharacter equipped={data.equippedItems} size={80} />
                    </div>
                  </div>
                </div>
                
                <div className="space-y-2 w-full max-w-xs">
                  <button onClick={() => setShowCats(true)} className="w-full py-3 bg-green-500 hover:bg-green-400 text-white font-black rounded-xl text-lg">ðŸŽ® PLAY</button>
                  <button onClick={() => setShowShop(true)} className="w-full py-2 bg-yellow-500 hover:bg-yellow-400 text-black font-bold rounded-xl">ðŸ›’ SHOP</button>
                  <button onClick={() => setShowHouse(true)} className="w-full py-2 bg-amber-600 hover:bg-amber-500 text-white font-bold rounded-xl">ðŸ  HOUSE</button>
                  <button onClick={() => setShowDressing(true)} className="w-full py-2 bg-pink-600 hover:bg-pink-500 text-white font-bold rounded-xl">ðŸ‘” DRESSING ROOM</button>
                  <button onClick={() => setShowCasino(true)} className="w-full py-2 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-xl">ðŸŽ° CASINO</button>
                </div>
                
                {showCats && (
                  <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
                    <div className="bg-slate-800 rounded-xl p-4 max-w-sm w-full">
                      <h2 className="text-white font-bold text-center mb-1">Pick Category</h2>
                      <div className="grid grid-cols-2 gap-2">
                        {CATEGORIES.map(c => (
                          <button key={c.id} onClick={() => start(c.id)} className={`p-3 rounded-lg bg-gradient-to-r ${c.color} text-white font-bold`}>
                            <div className="text-2xl">{c.icon}</div>
                            <div className="text-xs">{c.name}</div>
                          </button>
                        ))}
                      </div>
                      <button onClick={() => setShowCats(false)} className="w-full mt-3 py-2 bg-slate-600 text-white rounded-lg">Cancel</button>
                    </div>
                  </div>
                )}
                
                {showShop && <Shop playerData={data} onBuy={buy} onClose={() => setShowShop(false)} />}
                {showHouse && <VisualHouse playerData={data} setPlayerData={setData} onClose={() => setShowHouse(false)} />}
                {showDressing && <DressingRoom playerData={data} setPlayerData={setData} onClose={() => setShowDressing(false)} />}
                {showCasino && <Casino playerData={data} setPlayerData={setData} onClose={() => setShowCasino(false)} questions={questions} />}
              </div>
            );
          }

          // WON/LOST
          if (screen === 'won' || screen === 'lost') {
            return (
              <div className={`min-h-screen flex flex-col items-center justify-center p-4 ${screen === 'won' ? 'bg-gradient-to-b from-yellow-800 to-orange-900' : 'bg-gradient-to-b from-red-900 to-slate-900'}`}>
                <div className="text-6xl mb-4">{screen === 'won' ? 'ðŸ†' : 'ðŸ˜¢'}</div>
                <h1 className={`text-3xl font-black mb-2 ${screen === 'won' ? 'text-yellow-400' : 'text-red-400'}`}>
                  {screen === 'won' ? 'CHAMPION!' : 'GAME OVER'}
                </h1>
                <p className="text-white mb-1">Earned:</p>
                <p className="text-3xl font-bold text-green-400 mb-4">{formatMoney(earned)}</p>
                <p className="text-slate-300 mb-6">Total: {formatMoney(data.coins)}</p>
                <button onClick={() => setScreen('menu')} className="px-6 py-2 bg-blue-600 text-white font-bold rounded-xl">Menu</button>
              </div>
            );
          }

          // PLAYING
          const prog = (level / 15) * 100;
          return (
            <div className="min-h-screen bg-gradient-to-b from-slate-900 to-blue-900 p-2">
              <div className="max-w-xl mx-auto">
                <div className="flex justify-between items-center mb-2">
                  <button onClick={() => setScreen('menu')} className="text-white text-sm">â† Quit</button>
                  <PixelCharacter equipped={data.equippedItems} size={50} />
                  <span className="text-green-400 text-sm font-bold">{formatMoney(data.coins)}</span>
                </div>

                <div className="relative h-5 bg-slate-800 rounded-full overflow-hidden mb-2">
                  <div className="absolute top-0 bottom-0 left-[40%] w-0.5 bg-yellow-500" />
                  <div className="absolute top-0 bottom-0 left-[73%] w-0.5 bg-yellow-500" />
                  <div className="absolute top-0 bottom-0 left-0 bg-green-500 transition-all" style={{ width: `${prog}%` }} />
                </div>
                <div className="flex justify-between text-xs text-slate-400 mb-2">
                  <span>$100</span>
                  <span className="text-yellow-400 font-bold">{formatMoney(PRIZE_LADDER[level]?.amount || 100)}</span>
                  <span>$1M</span>
                </div>

                {msg && <div className={`mb-2 p-2 rounded-lg text-center text-white font-bold ${msg.includes('âœ…') || msg.includes('ðŸŒŸ') ? 'bg-green-800' : 'bg-red-800'}`}>{msg}</div>}

                {question && (
                  <div className="bg-slate-800 rounded-xl p-3 mb-3">
                    {question.big && question.question.includes('flag') && (
                      <div className="text-6xl text-center mb-2">{question.question.match(/[\u{1F1E0}-\u{1F1FF}]{2}/gu)?.[0]}</div>
                    )}
                    <div className="text-white text-lg font-semibold text-center">{question.question}</div>
                    <div className="text-blue-400 text-xs text-center mt-1">{question.category}</div>
                  </div>
                )}

                <div className="grid grid-cols-2 gap-2">
                  {question?.options.map((opt, i) => (
                    <button key={i} onClick={() => !revealed && setSelected(i)} disabled={revealed}
                      className={`p-3 rounded-lg font-bold text-left ${
                        revealed ? (i === question.correct ? 'bg-green-500' : i === selected ? 'bg-red-500' : 'bg-slate-700') :
                        i === selected ? 'bg-orange-500' : 'bg-slate-700 hover:bg-blue-600'
                      } text-white`}>
                      <span className="inline-block w-6 h-6 rounded-full bg-black/30 text-center mr-1 text-xs leading-6">{'ABCD'[i]}</span>
                      {opt}
                    </button>
                  ))}
                </div>

                {!revealed && selected !== null && (
                  <button onClick={confirm} className="w-full mt-3 py-2 bg-orange-500 text-white font-bold rounded-xl animate-pulse">
                    FINAL ANSWER
                  </button>
                )}

                {stats.streak > 0 && !revealed && (
                  <div className="mt-2 p-2 bg-red-900/50 rounded-lg text-red-400 text-center text-sm font-bold">
                    âš ï¸ {stats.streak}/3 wrong!
                  </div>
                )}

                <div className="mt-3 flex justify-center gap-4 text-sm">
                  <span className="text-green-400">âœ“{stats.correct}</span>
                  <span className="text-red-400">âœ—{stats.wrong}</span>
                  <span className="text-yellow-400">Lvl {level + 1}/15</span>
                </div>
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MillionaireQuiz />);
    </script>
</body>
</html>

```